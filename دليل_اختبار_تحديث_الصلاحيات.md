# ๐งช ุฏููู ุงุฎุชุจุงุฑ ุชุญุฏูุซ ุงูุตูุงุญูุงุช
## Permissions Update Testing Guide

---

## ๐ฏ **ุงููุฏู**

ุงูุชุฃูุฏ ูู ุฃู ุชุญุฏูุซ ุงูุตูุงุญูุงุช ูุนูู ุจุดูู ุตุญูุญ ูููุฑู ูู ุฌููุน ุฃูุญุงุก ุงููุธุงู.

---

## ๐ **ููุงุท ุงููุญุต**

### **1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช โ**
### **2. ุชุญุฏูุซ ุงูุณูุงู ุงูุนุงููู โ**  
### **3. ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู โ**
### **4. ุชุทุจูู ุงูุตูุงุญูุงุช ููุฑุงู โ**

---

## ๐งช **ุงุฎุชุจุงุฑุงุช ุดุงููุฉ**

### **ุงูุงุฎุชุจุงุฑ 1: ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช**

#### **ุงูุฎุทูุฉ 1: ุชุญูู ูู ุงูุจูุงูุงุช ุงูุญุงููุฉ**
```sql
-- ูู Supabase SQL Editor
SELECT 
  email,
  role,
  custom_permissions_enabled,
  array_length(permissions, 1) as permissions_count,
  permissions,
  updated_at
FROM users
WHERE email = 'YOUR_TEST_EMAIL';
```

#### **ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ุงูุตูุงุญูุงุช**
```sql
UPDATE users
SET 
  permissions = ARRAY[
    'projects.view',
    'projects.create',
    'boq.view',
    'kpi.view'
  ],
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'YOUR_TEST_EMAIL'
RETURNING email, permissions, updated_at;
```

#### **ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงูุชุญุฏูุซ**
```sql
SELECT 
  email,
  permissions,
  updated_at,
  CASE 
    WHEN updated_at > NOW() - INTERVAL '1 minute' THEN 'โ Recently updated'
    ELSE 'โ Not updated'
  END as status
FROM users
WHERE email = 'YOUR_TEST_EMAIL';
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุงูุตูุงุญูุงุช ูุญุฏูุซุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ `updated_at` ุญุฏูุซ
- โ `custom_permissions_enabled = true`

---

### **ุงูุงุฎุชุจุงุฑ 2: ุชุญุฏูุซ ุงูุณูุงู ุงูุนุงููู**

#### **ุงูุฎุทูุฉ 1: ูุชุญ Console ูู ุงููุชุตูุญ**
```
F12 โ Console
```

#### **ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ุงูุตูุงุญูุงุช ูู ุงููุงุฌูุฉ**
```
1. ุงุฐูุจ ุฅูู Settings โ Users
2. ุงุฎุชุฑ ูุณุชุฎุฏู
3. ุงุถุบุท "Permissions"
4. ุบููุฑ ุจุนุถ ุงูุตูุงุญูุงุช
5. ุงุญูุธ
```

#### **ุงูุฎุทูุฉ 3: ูุฑุงูุจุฉ Console**
```
ุงุจุญุซ ุนู ูุฐู ุงูุฑุณุงุฆู:
๐ Providers: Refreshing user profile...
โ Providers: User profile refreshed successfully
๐ Providers: Updated permissions: X
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ `refreshUserProfile()` ูุชู ุงุณุชุฏุนุงุคูุง
- โ ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ุชูุญูู ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ `appUser` ูู ุงูุณูุงู ุงูุนุงููู ูุญุฏูุซ

---

### **ุงูุงุฎุชุจุงุฑ 3: ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู**

#### **ุงูุฎุทูุฉ 1: ุชุญุฏูุซ ุงูุตูุงุญูุงุช**
```
1. ุฃุฒู ุตูุงุญูุฉ projects.create
2. ุงุญูุธ ุงูุชุบููุฑุงุช
3. ุฑุงูุจ ุงููุงุฌูุฉ
```

#### **ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูุฃุฒุฑุงุฑ**
```
1. ุงุฐูุจ ุฅูู ุตูุญุฉ Projects
2. ุชุญูู ูู ุฒุฑ "Add New Project"
3. ูุฌุจ ุฃู ูููู ูุฎูู
```

#### **ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ**
```
1. ุฑุงูุจ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
2. ุชุญูู ูู ุธููุฑ/ุฅุฎูุงุก ุงูุนูุงุตุฑ
3. ูุฌุจ ุฃู ุชุชุญุฏุซ ููุฑุงู
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุงูุฃุฒุฑุงุฑ ุชุฎุชูู/ุชุธูุฑ ููุฑุงู
- โ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุชุชุญุฏุซ
- โ ูุง ุญุงุฌุฉ ูุชุญุฏูุซ ุงูุตูุญุฉ

---

### **ุงูุงุฎุชุจุงุฑ 4: ุชุทุจูู ุงูุตูุงุญูุงุช ููุฑุงู**

#### **ุงูุณููุงุฑูู A: ุฅุฒุงูุฉ ุตูุงุญูุฉ projects.view**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'projects.view'),
  updated_at = NOW()
WHERE email = 'YOUR_TEST_EMAIL';
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุงููุณุชุฎุฏู ูุง ูุณุชุทูุน ุงูุฏุฎูู ูุตูุญุฉ Projects
- โ ุดุงุดุฉ "Access Denied" ุชุธูุฑ
- โ Console: `๐ Permission Guard: Result: โ Denied`

#### **ุงูุณููุงุฑูู B: ุฅุถุงูุฉ ุตูุงุญูุฉ projects.create**
```sql
UPDATE users
SET 
  permissions = array_append(permissions, 'projects.create'),
  updated_at = NOW()
WHERE email = 'YOUR_TEST_EMAIL';
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุฒุฑ "Add New Project" ูุธูุฑ
- โ Console: `๐ Permission Guard: Result: โ Granted`

---

## ๐ง **ุงุฎุชุจุงุฑุงุช ุชูููุฉ ูุชูุฏูุฉ**

### **ุงูุงุฎุชุจุงุฑ 5: ุงุฎุชุจุงุฑ ุงูุชุฒุงูู**

#### **ุงูุฎุทูุฉ 1: ูุชุญ ูุงูุฐุชูู**
```
1. ูุงูุฐุฉ 1: Admin ูุนุฏูู ุงูุตูุงุญูุงุช
2. ูุงูุฐุฉ 2: ุงููุณุชุฎุฏู ุงููุญุฏูุซ
```

#### **ุงูุฎุทูุฉ 2: ุชุญุฏูุซ ูู ุงููุงูุฐุฉ 1**
```
1. Admin ูุฒูู ุตูุงุญูุฉ projects.create
2. ูุญูุธ ุงูุชุบููุฑุงุช
```

#### **ุงูุฎุทูุฉ 3: ุงูุชุญูู ูู ุงููุงูุฐุฉ 2**
```
1. ุญุฏูุซ ุงูุตูุญุฉ (F5)
2. ุฒุฑ "Add New Project" ูุฌุจ ุฃู ูููู ูุฎูู
3. Console ูุฌุจ ุฃู ุชุธูุฑ: โ Denied
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุงูุชุญุฏูุซุงุช ุชุธูุฑ ูู ุฌููุน ุงูููุงูุฐ
- โ ุงูุตูุงุญูุงุช ุชูุทุจู ููุฑุงู
- โ ูุง ุญุงุฌุฉ ูุฅุนุงุฏุฉ ุชุณุฌูู ุงูุฏุฎูู

---

### **ุงูุงุฎุชุจุงุฑ 6: ุงุฎุชุจุงุฑ ุงูุฃุฏุงุก**

#### **ุงูุฎุทูุฉ 1: ููุงุณ ููุช ุงูุชุญุฏูุซ**
```javascript
// ูู Console
console.time('Permission Update')
// ุชุญุฏูุซ ุงูุตูุงุญูุงุช
console.timeEnd('Permission Update')
```

#### **ุงูุฎุทูุฉ 2: ูุฑุงูุจุฉ ุงูุดุจูุฉ**
```
F12 โ Network tab
1. ุญุฏูุซ ุงูุตูุงุญูุงุช
2. ุฑุงูุจ ุทูุจุงุช API
3. ุชุญูู ูู ุณุฑุนุฉ ุงูุงุณุชุฌุงุจุฉ
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุงูุชุญุฏูุซ ูุชู ูู ุฃูู ูู 2 ุซุงููุฉ
- โ ุทูุจ ูุงุญุฏ ููุท ููุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุง ุทูุจุงุช ุฅุถุงููุฉ ุบูุฑ ุถุฑูุฑูุฉ

---

## ๐ **ุงุฎุชุจุงุฑุงุช ุงูุฃุฎุทุงุก**

### **ุงูุงุฎุชุจุงุฑ 7: ุงุฎุชุจุงุฑ ุงูุฃุฎุทุงุก**

#### **ุงูุณููุงุฑูู A: ุงููุทุงุน ุงูุงุชุตุงู**
```
1. ูุทุน ุงูุฅูุชุฑูุช
2. ุญุงูู ุชุญุฏูุซ ุงูุตูุงุญูุงุช
3. ูุฌุจ ุฃู ุชุธูุฑ ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ
```

#### **ุงูุณููุงุฑูู B: ุตูุงุญูุงุช ุบูุฑ ุตุญูุญุฉ**
```sql
-- ูุญุงููุฉ ุฅุฏุฑุงุฌ ุตูุงุญูุฉ ุบูุฑ ููุฌูุฏุฉ
UPDATE users
SET 
  permissions = ARRAY['invalid.permission'],
  updated_at = NOW()
WHERE email = 'YOUR_TEST_EMAIL';
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุฑุณุงุฆู ุฎุทุฃ ูุงุถุญุฉ
- โ ุงููุธุงู ูุง ูุชููู
- โ ุงูุจูุงูุงุช ูุง ุชุชูู

---

## ๐ **ุงุฎุชุจุงุฑุงุช ุงูุฅุญุตุงุฆูุงุช**

### **ุงูุงุฎุชุจุงุฑ 8: ุงุฎุชุจุงุฑ ุงูุฃุฑูุงู**

#### **ุงูุฎุทูุฉ 1: ุนุฏู ุงูุตูุงุญูุงุช**
```sql
SELECT 
  email,
  role,
  array_length(permissions, 1) as count,
  permissions
FROM users
WHERE email = 'YOUR_TEST_EMAIL';
```

#### **ุงูุฎุทูุฉ 2: ููุงุฑูุฉ ูุน ุงููุชููุน**
```
Admin: ~45 permissions
Manager: ~25 permissions  
Engineer: ~15 permissions
Viewer: ~10 permissions
```

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:**
- โ ุงูุฃุฑูุงู ุตุญูุญุฉ
- โ ุงูุตูุงุญูุงุช ูุชุทุงุจูุฉ ูุน ุงูุฏูุฑ
- โ ูุง ุตูุงุญูุงุช ููุฑุฑุฉ

---

## ๐ฏ **ูุงุฆูุฉ ูุญุต ููุงุฆูุฉ**

### **โ ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช:**
- [ ] ุงูุตูุงุญูุงุช ุชูุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- [ ] `updated_at` ููุญุฏุซ
- [ ] `custom_permissions_enabled` ุตุญูุญ

### **โ ุชุญุฏูุซ ุงูุณูุงู ุงูุนุงููู:**
- [ ] `refreshUserProfile()` ูุนูู
- [ ] `appUser` ูุญุฏูุซ
- [ ] Console ููุธูุฑ ุงูุฑุณุงุฆู ุงูุตุญูุญุฉ

### **โ ุชุญุฏูุซ ูุงุฌูุฉ ุงููุณุชุฎุฏู:**
- [ ] ุงูุฃุฒุฑุงุฑ ุชุธูุฑ/ุชุฎุชูู ููุฑุงู
- [ ] ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุชุชุญุฏุซ
- [ ] ูุง ุญุงุฌุฉ ูุชุญุฏูุซ ุงูุตูุญุฉ

### **โ ุชุทุจูู ุงูุตูุงุญูุงุช:**
- [ ] ุงูุตูุญุงุช ูุญููุฉ
- [ ] ุงูุฃุฒุฑุงุฑ ูุญููุฉ
- [ ] Console ููุธูุฑ ุงููุชุงุฆุฌ ุงูุตุญูุญุฉ

### **โ ุงูุฃุฏุงุก:**
- [ ] ุงูุชุญุฏูุซ ุณุฑูุน (< 2 ุซุงููุฉ)
- [ ] ุทูุจุงุช API ููููุฉ
- [ ] ูุง ุชุฃุฎูุฑ ูู ุงููุงุฌูุฉ

---

## ๐ **ุงุฎุชุจุงุฑ ุณุฑูุน (5 ุฏูุงุฆู)**

### **ุงูุทุฑููุฉ ุงูุฃุณุฑุน:**

1. **ุงูุชุญ Supabase SQL Editor:**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'projects.create'),
  updated_at = NOW()
WHERE email = 'YOUR_TEST_EMAIL'
RETURNING email, permissions, updated_at;
```

2. **ุงูุชุญ Console (F12):**
```
ุงุจุญุซ ุนู: ๐ Permission Guard: Checking access for: projects.create
```

3. **ุงุฐูุจ ูุตูุญุฉ Projects:**
```
ุฒุฑ "Add New Project" ูุฌุจ ุฃู ูููู ูุฎูู
```

4. **ุงุณุชุนุฏ ุงูุตูุงุญูุฉ:**
```sql
UPDATE users
SET 
  permissions = array_append(permissions, 'projects.create'),
  updated_at = NOW()
WHERE email = 'YOUR_TEST_EMAIL';
```

5. **ุญุฏูุซ ุงูุตูุญุฉ:**
```
ุฒุฑ "Add New Project" ูุฌุจ ุฃู ูุธูุฑ
```

---

## ๐ **ุงููุชูุฌุฉ ุงููุชููุนุฉ**

ุฅุฐุง ูุฌุญุช ุฌููุน ุงูุงุฎุชุจุงุฑุงุช:

```
โ ุชุญุฏูุซ ุงูุตูุงุญูุงุช ูุนูู ุจุดูู ุตุญูุญ 100%
โ ุงูุชุญุฏูุซุงุช ุชุธูุฑ ููุฑุงู
โ ุงููุธุงู ูุณุชูุฑ ูููุซูู
โ ุฌุงูุฒ ููุฅูุชุงุฌ
```

---

## ๐ **ูููุงุช ุงูุงุฎุชุจุงุฑ**

1. **`scripts/test-permissions-update.js`** - ุณูุฑูุจุช ุงุฎุชุจุงุฑ ุดุงูู
2. **`Database/test_permissions_instant_update.sql`** - ุงุณุชุนูุงูุงุช SQL ููุงุฎุชุจุงุฑ
3. **`ุฏููู_ุงุฎุชุจุงุฑ_ุชุญุฏูุซ_ุงูุตูุงุญูุงุช.md`** - ูุฐุง ุงูุฏููู

---

## ๐ฏ **ุงุจุฏุฃ ุงูุงุฎุชุจุงุฑ ุงูุขู!**

**ุงูุณูุฑูุฑ ูุนูู!** ๐

1. ุงูุชุญ Supabase SQL Editor
2. ููุฐ ุงูุงุณุชุนูุงู ุงูุฃูู
3. ุฑุงูุจ ุงููุชุตูุญ
4. ุชุฃูุฏ ูู ุฃู ุงูุชุญุฏูุซุงุช ุชุธูุฑ ููุฑุงู!

**ุงููุธุงู ูุนูู ุจุดูู ูุซุงูู! ุฌุฑูุจู ุงูุขู!** โจ
