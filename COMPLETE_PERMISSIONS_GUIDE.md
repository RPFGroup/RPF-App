# 🔐 **دليل شامل لجميع الصلاحيات - Enhanced Permissions Manager**

---

## 🎯 **نظرة عامة**
نظام الصلاحيات المتقدم يحتوي على **54 صلاحية** موزعة على **8 فئات رئيسية** و **9 أنواع أفعال**. النظام مصمم ليكون شاملاً ومرناً وقابلاً للتوسع.

---

## 📊 **إحصائيات النظام**

| المقياس | العدد | التفاصيل |
|---------|-------|----------|
| **إجمالي الصلاحيات** | 54 | جميع الصلاحيات المتاحة |
| **الفئات الرئيسية** | 8 | Projects, BOQ, KPI, Reports, Users, Settings, System, Database |
| **أنواع الأفعال** | 9 | View, Create, Edit, Delete, Manage, Export, Approve, Backup, Restore |
| **الصلاحيات الأساسية** | 20 | للمشاريع، BOQ، KPI، التقارير |
| **صلاحيات الإدارة** | 21 | للمستخدمين والإعدادات |
| **صلاحيات النظام** | 13 | للنظام وقاعدة البيانات |

---

## 📁 **الفئات الرئيسية والصلاحيات**

### **1. 📂 Projects (5 صلاحيات)**
إدارة المشاريع والمشاريع الإنشائية

| الصلاحية | الاسم | الوصف | النوع |
|----------|-------|--------|-------|
| `projects.view` | View Projects | يمكن عرض قائمة المشاريع وتفاصيلها | view |
| `projects.create` | Create Projects | يمكن إنشاء مشاريع جديدة | create |
| `projects.edit` | Edit Projects | يمكن تعديل المشاريع الموجودة | edit |
| `projects.delete` | Delete Projects | يمكن حذف المشاريع | delete |
| `projects.export` | Export Projects | يمكن تصدير بيانات المشاريع | export |

### **2. 🎯 BOQ (6 صلاحيات)**
إدارة قوائم الكميات (Bill of Quantities)

| الصلاحية | الاسم | الوصف | النوع |
|----------|-------|--------|-------|
| `boq.view` | View BOQ | يمكن عرض أنشطة BOQ | view |
| `boq.create` | Create Activities | يمكن إنشاء أنشطة BOQ | create |
| `boq.edit` | Edit Activities | يمكن تعديل أنشطة BOQ | edit |
| `boq.delete` | Delete Activities | يمكن حذف أنشطة BOQ | delete |
| `boq.approve` | Approve Activities | يمكن الموافقة على أنشطة BOQ | approve |
| `boq.export` | Export BOQ | يمكن تصدير بيانات BOQ | export |

### **3. 📊 KPI (5 صلاحيات)**
إدارة مؤشرات الأداء الرئيسية

| الصلاحية | الاسم | الوصف | النوع |
|----------|-------|--------|-------|
| `kpi.view` | View KPIs | يمكن عرض سجلات KPI | view |
| `kpi.create` | Create KPIs | يمكن إنشاء سجلات KPI | create |
| `kpi.edit` | Edit KPIs | يمكن تعديل سجلات KPI | edit |
| `kpi.delete` | Delete KPIs | يمكن حذف سجلات KPI | delete |
| `kpi.export` | Export KPIs | يمكن تصدير بيانات KPI | export |

### **4. 📄 Reports (7 صلاحيات)**
إدارة التقارير والإحصائيات

| الصلاحية | الاسم | الوصف | النوع |
|----------|-------|--------|-------|
| `reports.view` | View Reports | يمكن عرض جميع التقارير | view |
| `reports.daily` | Daily Reports | يمكن الوصول للتقارير اليومية | view |
| `reports.weekly` | Weekly Reports | يمكن الوصول للتقارير الأسبوعية | view |
| `reports.monthly` | Monthly Reports | يمكن الوصول للتقارير الشهرية | view |
| `reports.financial` | Financial Reports | يمكن الوصول للتقارير المالية | view |
| `reports.export` | Export Reports | يمكن تصدير التقارير | export |
| `reports.print` | Print Reports | يمكن طباعة التقارير | export |

### **5. 👥 Users (5 صلاحيات)**
إدارة المستخدمين والصلاحيات

| الصلاحية | الاسم | الوصف | النوع |
|----------|-------|--------|-------|
| `users.view` | View Users | يمكن عرض قائمة المستخدمين | view |
| `users.create` | Create Users | يمكن إنشاء مستخدمين جدد | create |
| `users.edit` | Edit Users | يمكن تعديل تفاصيل المستخدمين | edit |
| `users.delete` | Delete Users | يمكن حذف المستخدمين | delete |
| `users.permissions` | Manage Permissions | يمكن إدارة صلاحيات المستخدمين | manage |

### **6. ⚙️ Settings (11 صلاحية)**
إدارة إعدادات النظام

| الصلاحية | الاسم | الوصف | النوع |
|----------|-------|--------|-------|
| `settings.view` | View Settings | يمكن عرض الإعدادات | view |
| `settings.company` | Manage Company Settings | يمكن إدارة إعدادات الشركة | manage |
| `settings.divisions` | Manage Divisions | يمكن إدارة الأقسام | manage |
| `settings.project_types` | Manage Project Types | يمكن إدارة أنواع المشاريع | manage |
| `settings.currencies` | Manage Currencies | يمكن إدارة العملات | manage |
| `settings.activities` | Manage Activities | يمكن إدارة قوالب الأنشطة | manage |
| `settings.holidays` | Manage Holidays | يمكن إدارة الإجازات وأيام العمل | manage |
| `settings.holidays.view` | View Holidays | يمكن عرض إعدادات الإجازات | view |
| `settings.holidays.create` | Create Holidays | يمكن إنشاء إجازات جديدة | create |
| `settings.holidays.edit` | Edit Holidays | يمكن تعديل الإجازات الموجودة | edit |
| `settings.holidays.delete` | Delete Holidays | يمكن حذف الإجازات | delete |

### **7. 🌐 System (5 صلاحيات)**
إدارة النظام والعمليات

| الصلاحية | الاسم | الوصف | النوع |
|----------|-------|--------|-------|
| `system.import` | Import Data | يمكن استيراد البيانات من الملفات | manage |
| `system.export` | Export System Data | يمكن تصدير جميع بيانات النظام | export |
| `system.backup` | Backup System | يمكن عمل نسخ احتياطية للنظام | manage |
| `system.audit` | View Audit Logs | يمكن عرض سجلات التدقيق | view |
| `system.search` | Search System | يمكن استخدام البحث العام | view |

### **8. 🗄️ Database (10 صلاحيات)**
إدارة قاعدة البيانات (للمديرين فقط)

| الصلاحية | الاسم | الوصف | النوع |
|----------|-------|--------|-------|
| `database.view` | View Database Stats | يمكن عرض إحصائيات قاعدة البيانات | view |
| `database.backup` | Create Backups | يمكن إنشاء نسخ احتياطية لقاعدة البيانات | backup |
| `database.restore` | Restore Database | يمكن استعادة قاعدة البيانات | restore |
| `database.export` | Export Tables | يمكن تصدير الجداول الفردية | export |
| `database.import` | Import Tables | يمكن استيراد البيانات للجداول | manage |
| `database.clear` | Clear Table Data | يمكن مسح جميع البيانات من الجداول (خطير) | delete |
| `database.manage` | Full Database Management | وصول كامل لإدارة قاعدة البيانات | manage |
| `database.templates` | Download Templates | يمكن تحميل قوالب البيانات | export |
| `database.analyze` | Performance Analysis | يمكن تحليل أداء قاعدة البيانات | view |
| `database.cleanup` | Data Cleanup | يمكن تنظيف البيانات القديمة | delete |

---

## 🎨 **أنواع الأفعال والألوان**

| النوع | اللون | الوصف | عدد الصلاحيات |
|-------|-------|--------|---------------|
| **View** | 🔵 أزرق | عرض البيانات | 15 |
| **Create** | 🟢 أخضر | إنشاء عناصر جديدة | 5 |
| **Edit** | 🟡 أصفر | تعديل العناصر الموجودة | 5 |
| **Delete** | 🔴 أحمر | حذف العناصر | 7 |
| **Manage** | 🟣 بنفسجي | إدارة شاملة | 11 |
| **Export** | 🟦 نيلي | تصدير البيانات | 8 |
| **Approve** | 🟢 زمردي | الموافقة على العناصر | 1 |
| **Backup** | 🟠 برتقالي | نسخ احتياطية | 1 |
| **Restore** | 🩷 وردي | استعادة البيانات | 1 |

---

## 🔍 **ميزات البحث والتصفية**

### **البحث الذكي**
- **البحث بالاسم**: البحث في أسماء الصلاحيات
- **البحث بالوصف**: البحث في أوصاف الصلاحيات
- **البحث بالمعرف**: البحث في معرفات الصلاحيات

### **التصفية المتقدمة**
- **تصفية بالفئة**: عرض صلاحيات فئة محددة
- **تصفية بالنوع**: عرض صلاحيات نوع محدد
- **تصفية مجمعة**: الجمع بين الفئة والنوع

### **عرض مرن**
- **عرض شبكي**: عرض الصلاحيات في شبكة
- **عرض قائمة**: عرض الصلاحيات في قائمة
- **أقسام قابلة للطي**: إظهار/إخفاء فئات الصلاحيات

---

## ⚡ **العمليات السريعة**

### **عمليات الحفظ**
- **حفظ التغييرات**: حفظ الصلاحيات المحددة
- **إعادة تعيين**: العودة للصلاحيات الافتراضية للدور
- **اختيار الكل**: تحديد جميع الصلاحيات
- **إلغاء الكل**: إلغاء تحديد جميع الصلاحيات

### **عمليات الفئة**
- **اختيار الفئة**: تحديد جميع صلاحيات فئة معينة
- **إلغاء الفئة**: إلغاء تحديد جميع صلاحيات فئة معينة
- **عرض الفئة**: إظهار/إخفاء صلاحيات فئة معينة

---

## 🎯 **الأدوار الافتراضية**

### **Admin (مدير)**
- **الصلاحيات**: جميع الـ 54 صلاحية
- **الوصف**: وصول كامل لجميع وظائف النظام

### **Manager (مدير مشروع)**
- **الصلاحيات**: 33 صلاحية
- **يشمل**: المشاريع، BOQ، KPI، التقارير، معظم الإعدادات
- **لا يشمل**: إدارة المستخدمين، العمليات الخطيرة في قاعدة البيانات

### **Engineer (مهندس)**
- **الصلاحيات**: 20 صلاحية
- **يشمل**: عرض المشاريع، إنشاء وتعديل BOQ وKPI، التقارير الأساسية
- **لا يشمل**: حذف المشاريع، إدارة المستخدمين، إدارة النظام

### **Viewer (مشاهد)**
- **الصلاحيات**: 9 صلاحيات
- **يشمل**: عرض المشاريع، BOQ، KPI، التقارير
- **لا يشمل**: إنشاء، تعديل، حذف أي عناصر

---

## 🚀 **كيفية الاستخدام**

### **الخطوة 1: الوصول لإدارة الصلاحيات**
```
1. اذهب إلى Settings → Users
2. اختر المستخدم المطلوب
3. اضغط "Permissions"
4. سيظهر EnhancedPermissionsManager
```

### **الخطوة 2: البحث عن الصلاحية**
```
1. استخدم مربع البحث للبحث السريع
2. اختر فئة من القائمة المنسدلة
3. اختر نوع من القائمة المنسدلة
4. استخدم التصفية المجمعة للبحث الدقيق
```

### **الخطوة 3: تحديد الصلاحيات**
```
1. انقر على الصلاحية لتحديدها/إلغاء تحديدها
2. استخدم "Select All" لتحديد جميع الصلاحيات
3. استخدم "Select None" لإلغاء تحديد الكل
4. استخدم "Reset to Role" للعودة للصلاحيات الافتراضية
```

### **الخطوة 4: حفظ التغييرات**
```
1. اضغط "Save Changes" لحفظ الصلاحيات
2. سيظهر تأكيد نجاح العملية
3. ستتحدث الصلاحيات فوراً للمستخدم
```

---

## 🛡️ **الحماية والأمان**

### **فحص الصلاحيات**
- **فحص الواجهة**: الصلاحيات تتحكم في ظهور الأزرار والقوائم
- **فحص المحتوى**: الصلاحيات تتحكم في الوصول للمحتوى
- **فحص العمليات**: الصلاحيات تتحكم في تنفيذ العمليات

### **الصلاحيات الخطيرة**
- **database.clear**: مسح جميع البيانات (للمدير فقط)
- **database.restore**: استعادة قاعدة البيانات (للمدير فقط)
- **users.delete**: حذف المستخدمين (للمدير فقط)

### **التحقق المتعدد المستويات**
- **فحص الدور**: التحقق من الدور الأساسي
- **فحص الصلاحية**: التحقق من الصلاحية المحددة
- **فحص السياق**: التحقق من السياق والظروف

---

## 📈 **الإحصائيات والتحليلات**

### **إحصائيات الصلاحيات**
- **إجمالي الصلاحيات المحددة**: عدد الصلاحيات المحددة للمستخدم
- **الصلاحيات لكل فئة**: عدد الصلاحيات المحددة في كل فئة
- **نسبة التغطية**: نسبة الصلاحيات المحددة من إجمالي الصلاحيات

### **تحليل الأدوار**
- **مقارنة الأدوار**: مقارنة الصلاحيات بين الأدوار المختلفة
- **تتبع التغييرات**: تتبع تغييرات الصلاحيات للمستخدمين
- **تقارير الصلاحيات**: تقارير مفصلة عن استخدام الصلاحيات

---

## 🔧 **الصيانة والتطوير**

### **إضافة صلاحيات جديدة**
```
1. أضف الصلاحية في ALL_PERMISSIONS في lib/permissionsSystem.ts
2. أضف الصلاحية في DEFAULT_ROLE_PERMISSIONS للأدوار المناسبة
3. أضف فحص الصلاحية في المكونات المطلوبة
4. اختبر الصلاحية الجديدة
```

### **تعديل الأدوار الافتراضية**
```
1. عدل DEFAULT_ROLE_PERMISSIONS في lib/permissionsSystem.ts
2. اختبر التغييرات على المستخدمين
3. تأكد من عدم كسر الوظائف الموجودة
```

### **إضافة فئات جديدة**
```
1. أضف الفئة الجديدة في ALL_PERMISSIONS
2. أضف أيقونة الفئة في CATEGORY_ICONS
3. أضف لون الفئة في ACTION_COLORS إذا لزم الأمر
4. اختبر الفئة الجديدة
```

---

## 🎊 **الخلاصة**

**EnhancedPermissionsManager** هو نظام شامل ومتكامل لإدارة الصلاحيات يحتوي على:

✅ **54 صلاحية شاملة** تغطي جميع جوانب النظام  
✅ **8 فئات منظمة** تسهل التنقل والإدارة  
✅ **9 أنواع أفعال** تسمح بالتحكم الدقيق  
✅ **بحث وتصفية متقدمة** للعثور السريع على الصلاحيات  
✅ **واجهة سهلة الاستخدام** مع ألوان وأيقونات واضحة  
✅ **حماية متعددة المستويات** لضمان الأمان  
✅ **مرونة كاملة** لإضافة وتعديل الصلاحيات  

**النظام جاهز للاستخدام في الإنتاج!** 🚀✨
