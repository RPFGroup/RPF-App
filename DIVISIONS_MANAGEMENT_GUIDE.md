# ๐ข ุฏููู ุฅุฏุงุฑุฉ ุงูุฃูุณุงู (Divisions Management)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงูุฃูุณุงู (Divisions) ูู ุงูุชุทุจูู ูุน ุฅููุงููุฉ ุงูุฅุถุงูุฉ ูุงูุชุนุฏูู ูู ุฎูุงู Supabase.

## โจ ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ

### 1. **ุงูุฃูุณุงู ุงูุงูุชุฑุงุถูุฉ**
- Enabling Division
- Soil Improvement Division
- Infrastructure Division
- Marine Division

### 2. **ุฅุฏุงุฑุฉ ูุงููุฉ ููุฃูุณุงู**
- โ ุฅุถุงูุฉ ุฃูุณุงู ุฌุฏูุฏุฉ
- โ ุชุนุฏูู ุงูุฃูุณุงู ุงูููุฌูุฏุฉ
- โ ุญุฐู (ุชุนุทูู) ุงูุฃูุณุงู
- โ ุงูุจุญุซ ูุงูููุชุฑุฉ
- โ ุชุชุจุน ุนุฏุฏ ุงูุงุณุชุฎุฏุงูุงุช

### 3. **ุงูุชูุงูู ูุน ุงูููุงุฐุฌ**
- ุงููุงุฆูุฉ ุงูููุณุฏูุฉ ูู Smart Project Creator
- ุฅููุงููุฉ ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ ูุจุงุดุฑุฉ ูู ุงููููุฐุฌ
- ุชุญุฏูุซ ุชููุงุฆู ูููุงุฆูุฉ ุนูุฏ ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### ุงููููุงุช ุงูุฌุฏูุฏุฉ

1. **`lib/divisionsManager.ts`**
   - ุฅุฏุงุฑุฉ ุงูุนูููุงุช ูุน Supabase
   - ุฏูุงู ููุฅุถุงูุฉุ ุงูุชุนุฏููุ ุงูุญุฐูุ ูุงูุจุญุซ
   - ุชุชุจุน ุนุฏุฏ ุงุณุชุฎุฏุงู ูู ูุณู

2. **`components/settings/DivisionsManager.tsx`**
   - ูุงุฌูุฉ ูุณุชุฎุฏู ูุฅุฏุงุฑุฉ ุงูุฃูุณุงู
   - ูููุฐุฌ ุฅุถุงูุฉ/ุชุนุฏูู ุงูุฃูุณุงู
   - ุนุฑุถ ุงูุฃูุณุงู ูู ุดูู ุจุทุงูุงุช

3. **`Database/divisions-table-schema.sql`**
   - SQL Schema ูุฌุฏูู ุงูุฃูุณุงู
   - Row Level Security (RLS)
   - Triggers ููุชุญุฏูุซ ุงูุชููุงุฆู

### ุงูุชุญุฏูุซุงุช ุนูู ุงููููุงุช ุงูููุฌูุฏุฉ

1. **`components/projects/IntelligentProjectForm.tsx`**
   - ุชุญููู ุงูุฃูุณุงู ูู Supabase
   - ุฅููุงููุฉ ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ ูู ุงููููุฐุฌ
   - ุฒูุงุฏุฉ ุนุฏุงุฏ ุงูุงุณุชุฎุฏุงู ุนูุฏ ุงุฎุชูุงุฑ ูุณู

2. **`components/settings/SettingsPage.tsx`**
   - ุฅุถุงูุฉ ุชุงุจ "Divisions" ูููุณุคูููู ูุงููุฏุฑุงุก
   - ุนุฑุถ ูููู DivisionsManager

## ๐ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `divisions`

```sql
CREATE TABLE divisions (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  name VARCHAR(255) NOT NULL UNIQUE,
  code VARCHAR(10),
  description TEXT,
  is_active BOOLEAN DEFAULT TRUE,
  usage_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### ุงูุฃุนูุฏุฉ

- **id**: ุงููุนุฑู ุงููุฑูุฏ (UUID)
- **name**: ุงุณู ุงููุณู (ูุทููุจ ููุฑูุฏ)
- **code**: ุฑูุฒ ุงููุณู (ุงุฎุชูุงุฑูุ ูุซู: ENA, SID)
- **description**: ูุตู ุงููุณู (ุงุฎุชูุงุฑู)
- **is_active**: ูู ุงููุณู ูุดุทุ (ููุญุฐู ุงูุขูู)
- **usage_count**: ุนุฏุฏ ุงููุดุงุฑูุน ุงูุชู ุชุณุชุฎุฏู ูุฐุง ุงููุณู
- **created_at**: ุชุงุฑูุฎ ุงูุฅูุดุงุก
- **updated_at**: ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ

## ๐ ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### 1. ุฅูุดุงุก ุฌุฏูู ุงูุฃูุณุงู ูู Supabase

ูู ุจุชุดุบูู SQL Script ูู Supabase SQL Editor:

```bash
# ุงูุชุญ Supabase Dashboard
# ุงูุชูู ุฅูู SQL Editor
# ููุฐ ูุญุชูู ููู: Database/divisions-table-schema.sql
```

### 2. ุงูุชุญูู ูู Row Level Security (RLS)

ุงูุตูุงุญูุงุช ุงููุถุจูุทุฉ:
- **ุงููุฑุงุกุฉ**: ุฌููุน ุงููุณุชุฎุฏููู (ุงูุฃูุณุงู ุงููุดุทุฉ ููุท)
- **ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู/ุงูุญุฐู**: ุงููุณุชุฎุฏููู ุงููุตุฑุญ ููู ููุท

## ๐ป ุงูุงุณุชุฎุฏุงู

### ูููุทูุฑูู

#### ุฌูุจ ุฌููุน ุงูุฃูุณุงู

```typescript
import { getAllDivisions, getDivisionNames } from '@/lib/divisionsManager'

// ุฌูุจ ุฌููุน ุจูุงูุงุช ุงูุฃูุณุงู
const divisions = await getAllDivisions()

// ุฌูุจ ุฃุณูุงุก ุงูุฃูุณุงู ููุท (ููููุงุฆู ุงูููุณุฏูุฉ)
const divisionNames = await getDivisionNames()
```

#### ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ

```typescript
import { addDivision } from '@/lib/divisionsManager'

const result = await addDivision({
  name: 'New Division',
  code: 'NEW',
  description: 'Description of the division',
  is_active: true
})

if (result.success) {
  console.log('Division added:', result.data)
}
```

#### ุชุญุฏูุซ ูุณู

```typescript
import { updateDivision } from '@/lib/divisionsManager'

const result = await updateDivision(divisionId, {
  name: 'Updated Division Name',
  description: 'Updated description'
})
```

#### ุญุฐู (ุชุนุทูู) ูุณู

```typescript
import { deleteDivision } from '@/lib/divisionsManager'

const result = await deleteDivision(divisionId)
```

#### ุชุชุจุน ุงูุงุณุชุฎุฏุงู

```typescript
import { incrementDivisionUsage } from '@/lib/divisionsManager'

// ูุชู ุงุณุชุฏุนุงุคูุง ุชููุงุฆูุงู ุนูุฏ ุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ
await incrementDivisionUsage('Enabling Division')
```

### ูููุณุชุฎุฏููู

#### ุงููุตูู ุฅูู ุฅุฏุงุฑุฉ ุงูุฃูุณุงู

1. ุงูุชูู ุฅูู **Settings** โ๏ธ
2. ุงุฎุชุฑ ุชุงุจ **Divisions** ๐ข
3. ููููู:
   - ุนุฑุถ ุฌููุน ุงูุฃูุณุงู
   - ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ
   - ุชุนุฏูู ูุณู ููุฌูุฏ
   - ุญุฐู ูุณู

#### ุฅุถุงูุฉ ูุณู ูู Smart Project Creator

1. ุงูุชุญ ูููุฐุฌ ุฅูุดุงุก ูุดุฑูุน ุฌุฏูุฏ
2. ูู ุญูู **Responsible Division**:
   - ุงุจุฏุฃ ุจูุชุงุจุฉ ุงุณู ุงููุณู
   - ุฅุฐุง ูู ููู ููุฌูุฏุงูุ ุณุชุธูุฑ ุฎูุงุฑ "โ Add as new division"
   - ุงุถุบุท ุนููู ูุฅุถุงูุฉ ุงููุณู ูุจุงุดุฑุฉ

## ๐ ุงูุฃูุงู

### Row Level Security (RLS)

```sql
-- ุณูุงุณุฉ ุงููุฑุงุกุฉ (ุงูุฌููุน)
CREATE POLICY "Anyone can view active divisions"
  ON divisions FOR SELECT
  USING (is_active = TRUE);

-- ุณูุงุณุฉ ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู/ุงูุญุฐู (ุงููุตุฑุญ ููู ููุท)
CREATE POLICY "Authenticated users can manage divisions"
  ON divisions FOR ALL
  TO authenticated
  USING (TRUE);
```

### ุตูุงุญูุงุช ุงููุณุชุฎุฏููู

- **Admin & Manager**: ุงููุตูู ุงููุงูู ูุฅุฏุงุฑุฉ ุงูุฃูุณุงู
- **Engineer & Viewer**: ุงููุฑุงุกุฉ ููุท

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุฏุงูุฉ `get_division_stats()`

```sql
SELECT * FROM get_division_stats();
```

ุชุนุฑุถ:
- ุงุณู ุงููุณู
- ุนุฏุฏ ุงููุดุงุฑูุน
- ุฅุฌูุงูู ูููุฉ ุงูุนููุฏ

## ๐ฏ ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุงุณุชุฎุฏู ุฃููุงุฏ ูุตูุฑุฉ**: 
   - ูุซู: ENA, SID, INF, MAR
   - ุชุณูู ุงูุชุนุฑู ุงูุณุฑูุน

2. **ุฃุถู ูุตู ูุงุถุญ**:
   - ูุณุงุนุฏ ูู ููู ุฏูุฑ ุงููุณู
   - ูููุฏ ูููุณุชุฎุฏููู ุงูุฌุฏุฏ

3. **ูุง ุชุญุฐู ุงูุฃูุณุงู ุงููุณุชุฎุฏูุฉ**:
   - ุงููุธุงู ูููู ุจุชุนุทูููุง ุจุฏูุงู ูู ุงูุญุฐู
   - ูุญุงูุธ ุนูู ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ

4. **ุชุชุจุน ุงูุงุณุชุฎุฏุงู**:
   - ุฑุงูุจ usage_count ููุนุฑูุฉ ุงูุฃูุณุงู ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู
   - ูุณุงุนุฏ ูู ุงูุชุฎุทูุท ูุงูุชูุฒูุน

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุณู ูุง ูุธูุฑ ูู ุงููุงุฆูุฉ ุงูููุณุฏูุฉ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู `is_active = true`
- ูู ุจุชุญุฏูุซ ุงูุตูุญุฉ
- ุชุญูู ูู ุงูุงุชุตุงู ุจู Supabase

### ุฎุทุฃ ุนูุฏ ุฅุถุงูุฉ ูุณู ุฌุฏูุฏ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ูุณู ุจููุณ ุงูุงุณู
- ุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู
- ุฑุงุฌุน RLS Policies ูู Supabase

### ุนุฏุงุฏ ุงูุงุณุชุฎุฏุงู ูุง ูุชุญุฏุซ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุงุณุชุฏุนุงุก `incrementDivisionUsage()`
- ุชุญูู ูู ุงูู console ููุฃุฎุทุงุก
- ุชุฃูุฏ ูู ูุฌูุฏ ุงููุณู ูู ุงูุฌุฏูู

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

### ูุฎุทุท ุงูุชุทููุฑ
- [ ] ุฅุถุงูุฉ ุตูุงุญูุงุช ูุฎุตุตุฉ ููู ูุณู
- [ ] ุชูุงุฑูุฑ ุชูุตูููุฉ ููู ูุณู
- [ ] ุงุณุชูุฑุงุฏ/ุชุตุฏูุฑ ุงูุฃูุณุงู
- [ ] ุฏูุฌ ุงูุฃูุณุงู
- [ ] ุชุงุฑูุฎ ุงูุชุบููุฑุงุช (Audit Log)

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู ุฃู ูุฏูู ุงูุชุฑุงุญุงุช:
1. ุชุญูู ูู console.log ููุฃุฎุทุงุก
2. ุฑุงุฌุน Supabase logs
3. ุชุฃูุฏ ูู ุชูููุฐ SQL Schema ุจุดูู ุตุญูุญ

---

**ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ:** AI Assistant  
**ุงูุชุงุฑูุฎ:** 2025-10-07  
**ุงูุฅุตุฏุงุฑ:** 1.0.0

