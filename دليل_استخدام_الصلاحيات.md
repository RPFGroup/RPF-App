# 🔐 دليل استخدام نظام الصلاحيات

## 🚀 الخطوات السريعة

---

## الخطوة 1: تطبيق SQL Script ⚡

### في Supabase Dashboard:

```
1. افتح https://supabase.com
2. اختر مشروعك
3. اذهب إلى SQL Editor
4. انسخ محتوى: Database/add-permissions-columns.sql
5. الصقه في المحرر
6. اضغط Run
```

**النتيجة:**
```
✅ Permissions columns added successfully!
✅ Total users updated: X
```

---

## الخطوة 2: إعادة تحميل الصفحة 🔄

```
1. اذهب إلى /users
2. اضغط Ctrl + Shift + R
3. سترى التحديثات الجديدة
```

---

## الخطوة 3: استكشاف الواجهة الجديدة 🎨

### ما الجديد في جدول المستخدمين:

#### عمود "Permissions":
```
📊 عدد الصلاحيات
🔑 Badge "Custom" إذا كانت مخصصة
مثال: "16 permissions" أو "18 permissions 🔑 Custom"
```

#### عمود "Status":
```
✅ Active (قابل للنقر)
❌ Inactive (قابل للنقر)

النقر عليه = تغيير الحالة فوراً
```

#### زر جديد في Actions:
```
🛡️ Shield - إدارة الصلاحيات
✏️ Edit - تعديل المعلومات
🗑️ Delete - حذف المستخدم
```

---

## استخدام Permissions Manager 🎯

### فتح Permissions Manager:

```
1. في جدول المستخدمين
2. اضغط زر 🛡️ في صف أي مستخدم
3. ستفتح نافذة كبيرة
```

### ما ستراه:

#### الرأس:
```
╔══════════════════════════════════════════════╗
║ Manage Permissions - Ahmed Ali               ║
║ ahmed@company.com • Role: ENGINEER           ║
╠══════════════════════════════════════════════╣
║ Default Role: Engineer has 16 permissions    ║
╚══════════════════════════════════════════════╝
```

#### وضع الصلاحيات:
```
┌──────────────────────────────────────────────┐
│ ☐ Enable Custom Permissions                 │
│                                              │
│ ⚠️ Custom mode: Override role defaults      │
│ OR                                           │
│ ✅ Using default role permissions            │
│                                              │
│ [Reset to Role Defaults] ← زر               │
└──────────────────────────────────────────────┘
```

#### الإحصائيات:
```
┌─────────────┬──────────────┬─────────────┬────────────┐
│Total: 16    │Can Create: 4 │Can Edit: 3  │Can Del: 0  │
└─────────────┴──────────────┴─────────────┴────────────┘
```

#### الصلاحيات حسب الفئة:

##### Projects (2/5):
```
┌──────────────────────────────────────────────┐
│ PROJECTS                            (2/5)    │
│ [Select All] [Clear All]                     │
├──────────────────────────────────────────────┤
│ ☑ View Projects      [view]   ✅ Role Default│
│ ☐ Create Projects    [create]                │
│ ☐ Edit Projects      [edit]                  │
│ ☐ Delete Projects    [delete]                │
│ ☑ Export Projects    [export] ✅ Role Default│
└──────────────────────────────────────────────┘
```

##### BOQ (4/6):
```
┌──────────────────────────────────────────────┐
│ BOQ                                 (4/6)    │
│ [Select All] [Clear All]                     │
├──────────────────────────────────────────────┤
│ ☑ View BOQ           [view]   ✅ Role Default│
│ ☑ Create Activities  [create] ✅ Role Default│
│ ☑ Edit Activities    [edit]   ✅ Role Default│
│ ☐ Delete Activities  [delete]                │
│ ☐ Approve Activities [approve]               │
│ ☑ Export BOQ         [export] ✅ Role Default│
└──────────────────────────────────────────────┘
```

... (باقي الفئات)

---

## 🎯 حالات الاستخدام

### حالة 1: منح صلاحية إضافية

```
المطلوب: إعطاء مهندس صلاحية حذف الأنشطة

1. اضغط 🛡️ على المهندس
2. فعّل "Enable Custom Permissions"
3. في قسم BOQ:
   - اضغط على "Delete Activities"
   - سيصبح ☑
4. اضغط Save
5. النتيجة:
   - 16 → 17 permissions
   - ظهور 🔑 Custom badge
```

### حالة 2: إزالة صلاحية

```
المطلوب: منع manager من رؤية التقارير المالية

1. اضغط 🛡️ على المدير
2. فعّل "Enable Custom Permissions"
3. في قسم Reports:
   - ألغِ تحديد "Financial Reports"
   - سيصبح ☐
4. اضغط Save
5. النتيجة:
   - 24 → 23 permissions
   - لن يرى التقارير المالية
```

### حالة 3: إيقاف مستخدم مؤقتاً

```
المطلوب: إيقاف مستخدم لفترة إجازة

1. في جدول المستخدمين
2. اضغط على "Active" في عمود Status
3. سيتحول إلى "Inactive"
4. النتيجة:
   - المستخدم لا يمكنه الدخول
   - الصف يصبح شفاف قليلاً
   - البيانات محفوظة
   
للإعادة:
1. اضغط على "Inactive"
2. سيتحول إلى "Active"
3. المستخدم يمكنه الدخول مرة أخرى
```

### حالة 4: دور مخصص (محاسب)

```
المطلوب: محاسب - عرض فقط + تقارير مالية

الأساس: Viewer (9 صلاحيات)

التخصيص:
1. فعّل Custom Mode
2. أضف:
   - reports.financial
   - reports.export
   - projects.export
3. النتيجة: 12 صلاحية
4. دور مخصص للمحاسب!
```

---

## 📊 لوحة التحكم الجديدة

### في صفحة Users:

```
╔═══════════════════════════════════════════════════════════╗
║                    User Management                        ║
║          Manage system users and permissions              ║
╠═══════════════════════════════════════════════════════════╣
║ [Search...]              [All Roles ▼]    [+ Add User]   ║
╠═══════════════════════════════════════════════════════════╣
║ User    │Role    │Permissions  │Division│Status │Actions ║
╠═══════════════════════════════════════════════════════════╣
║ Ahmed   │Engineer│16 perms     │Civil   │Active │🛡️✏️🗑️  ║
║ Sara    │Manager │24 perms     │Infra   │Active │🛡️✏️🗑️  ║
║ Mohamed │Viewer  │9 perms      │Marine  │Inactive│🛡️✏️🗑️ ║
║ Fatima  │Engineer│18 perms 🔑  │Soil    │Active │🛡️✏️🗑️  ║
║         │        │    Custom   │        │       │        ║
╚═══════════════════════════════════════════════════════════╝

🔑 Custom = صلاحيات مخصصة
```

---

## ✅ Checklist للتطبيق

### قبل البدء:
- [ ] تطبيق SQL Script في Supabase
- [ ] تأكد من وجود أعمدة جديدة
- [ ] إعادة تحميل الصفحة

### الاختبار:
- [ ] افتح /users
- [ ] لاحظ العمودين الجديدين
- [ ] اضغط 🛡️ على مستخدم
- [ ] جرّب Custom Mode
- [ ] احفظ التغييرات
- [ ] راجع التحديثات في الجدول

### التأكد:
- [ ] الصلاحيات تظهر بشكل صحيح
- [ ] Custom badge يظهر عند التفعيل
- [ ] Status يتغير عند النقر
- [ ] التعديلات تُحفظ بنجاح

---

## 🎉 النتيجة النهائية

صفحة Users الآن:
- ✅ **39 صلاحية دقيقة**
- ✅ **7 فئات منظمة**
- ✅ **Custom permissions mode**
- ✅ **Active/Inactive toggle**
- ✅ **واجهة متقدمة**
- ✅ **تحكم كامل ودقيق**

---

**جاهز للاستخدام! 🚀**

**افتح /users وجرّب الآن!** ✨

