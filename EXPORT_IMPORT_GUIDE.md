# 📤📥 دليل التصدير والاستيراد الشامل
# Export & Import Complete Guide

## 🎯 نظرة عامة

تم إضافة خاصية **Export** و**Import** لجميع الصفحات الرئيسية في النظام:
- ✅ **Projects Management** - إدارة المشاريع
- ✅ **Bill of Quantities (BOQ)** - بيان الكميات
- ✅ **KPI Tracking** - متابعة مؤشرات الأداء

---

## ✨ الميزات الأساسية

### 🎨 Export (التصدير)
- **صيغ متعددة**: CSV و Excel (xlsx) و JSON
- **تصدير ذكي**: يصدر فقط البيانات الظاهرة في الصفحة الحالية
- **تسمية تلقائية**: إضافة التاريخ تلقائياً للملف
- **دعم Unicode**: دعم كامل للغة العربية والأحرف الخاصة

### 📥 Import (الاستيراد)
- **معاينة قبل الحفظ**: عرض البيانات المستوردة قبل الإضافة
- **التحقق التلقائي**: فحص الأعمدة المطلوبة
- **قوالب جاهزة**: تحميل قالب Excel فارغ للتعبئة
- **دعم متعدد**: CSV و Excel (xlsx/xls)
- **معالجة أخطاء**: رسائل واضحة عند وجود مشاكل

---

## 🚀 كيفية الاستخدام

### 📤 تصدير البيانات (Export)

#### **1. في صفحة Projects:**
```
1. انتقل إلى "Projects Management"
2. استخدم الفلاتر لاختيار المشاريع المطلوبة (اختياري)
3. اضغط على زر "تصدير" (Export)
4. اختر الصيغة:
   - CSV (.csv) - للاستخدام العام
   - Excel (.xlsx) - للتحليل والتنسيق
   - JSON (.json) - للمطورين
5. سيتم تحميل الملف تلقائياً

اسم الملف: Projects_20251015.xlsx
عدد الأعمدة: 12
```

#### **2. في صفحة BOQ:**
```
1. انتقل إلى "Bill of Quantities (BOQ)"
2. حدد المشاريع المطلوبة من الفلتر
3. اضغط على زر "تصدير"
4. اختر الصيغة المناسبة
5. سيتم تحميل الملف

اسم الملف: BOQ_Activities_20251015.xlsx
عدد الأعمدة: 23
```

#### **3. في صفحة KPI:**
```
1. انتقل إلى "KPI Tracking"
2. حدد المشاريع من الفلتر (إلزامي للعرض)
3. اضغط على زر "تصدير"
4. اختر الصيغة
5. سيتم تحميل الملف

اسم الملف: KPI_Records_20251015.xlsx
عدد الأعمدة: 17
```

---

### 📥 استيراد البيانات (Import)

#### **خطوات عامة:**

**الخطوة 1: تحميل القالب (Template)**
```
1. اضغط على زر "قالب" 📄 بجانب زر "استيراد"
2. سيتم تحميل ملف Excel فارغ يحتوي على:
   - أسماء الأعمدة المطلوبة
   - سطر واحد فارغ كمثال
3. افتح الملف في Excel أو Google Sheets
```

**الخطوة 2: تعبئة البيانات**
```
1. املأ البيانات في الأعمدة المناسبة
2. تأكد من:
   ✅ عدم تغيير أسماء الأعمدة
   ✅ تعبئة الأعمدة المطلوبة (Required)
   ✅ تنسيق التواريخ: YYYY-MM-DD
   ✅ الأرقام بدون فواصل أو رموز
3. احفظ الملف (.xlsx أو .csv)
```

**الخطوة 3: استيراد الملف**
```
1. اضغط على زر "استيراد" 📥
2. اختر الملف من جهازك
3. انتظر عرض المعاينة
4. تحقق من البيانات:
   ✅ عدد السجلات صحيح
   ✅ لا توجد أخطاء في التحقق
   ✅ البيانات تظهر بشكل سليم
5. اضغط "استيراد X سجل"
6. انتظر رسالة النجاح ✅
```

---

## 📋 الأعمدة المطلوبة (Required Columns)

### **Projects (المشاريع)**

**أعمدة إلزامية:**
- `Project Code` - كود المشروع (مطلوب)
- `Project Name` - اسم المشروع (مطلوب)

**أعمدة اختيارية:**
- `Project Sub-Code` - الكود الفرعي
- `Project Type` - نوع المشروع
- `Responsible Division` - القسم المسؤول
- `Plot Number` - رقم القطعة
- `KPI Completed` - اكتمال KPI (YES/NO)
- `Project Status` - حالة المشروع (active/completed)
- `Contract Amount` - قيمة العقد
- `Currency` - العملة (AED/USD/SAR)

---

### **BOQ Activities (أنشطة بيان الكميات)**

**أعمدة إلزامية:**
- `Project Code` - كود المشروع (مطلوب)
- `Activity Name` - اسم النشاط (مطلوب)
- `Unit` - الوحدة (مطلوب)

**أعمدة اختيارية:**
- `Project Sub Code` - الكود الفرعي
- `Project Full Code` - الكود الكامل
- `Activity` - النشاط
- `Activity Division` - قسم النشاط
- `Zone Ref` - المنطقة
- `Total Units` - إجمالي الكميات
- `Planned Units` - الكميات المخططة
- `Actual Units` - الكميات الفعلية
- `Rate` - السعر
- `Total Value` - القيمة الإجمالية
- `Planned Activity Start Date` - تاريخ البدء (YYYY-MM-DD)
- `Deadline` - الموعد النهائي (YYYY-MM-DD)
- `Calendar Duration` - المدة

---

### **KPI Records (سجلات مؤشرات الأداء)**

**أعمدة إلزامية:**
- `Project Code` - كود المشروع (مطلوب)
- `Activity Name` - اسم النشاط (مطلوب)
- `Quantity` - الكمية (مطلوب)
- `Input Type` - نوع الإدخال (Planned/Actual) (مطلوب)

**أعمدة اختيارية:**
- `Project Full Code` - الكود الكامل
- `Project Sub Code` - الكود الفرعي
- `Activity` - النشاط
- `Unit` - الوحدة
- `Section` - القسم
- `Zone` - المنطقة
- `Drilled Meters` - الأمتار المحفورة
- `Value` - القيمة
- `Target Date` - التاريخ المستهدف (YYYY-MM-DD)
- `Actual Date` - التاريخ الفعلي (YYYY-MM-DD)
- `Activity Date` - تاريخ النشاط (YYYY-MM-DD)
- `Day` - اليوم
- `Recorded By` - تم التسجيل بواسطة
- `Notes` - ملاحظات

---

## ⚠️ نصائح وتحذيرات

### ✅ نصائح للتصدير:
1. **استخدم الفلاتر أولاً**: حدد البيانات المطلوبة قبل التصدير
2. **اختر الصيغة المناسبة**:
   - CSV: للبيانات البسيطة وسهولة التحرير
   - Excel: لتحليل البيانات والرسوم البيانية
   - JSON: للتكامل مع أنظمة أخرى
3. **تحقق من عدد السجلات**: يظهر في أسفل القائمة المنسدلة

### ⚠️ تحذيرات للاستيراد:
1. **لا تغير أسماء الأعمدة**: يجب أن تطابق القالب تماماً
2. **تواريخ صحيحة**: استخدم تنسيق YYYY-MM-DD فقط
3. **أرقام نظيفة**: بدون فواصل أو رموز (مثال: 1000 وليس 1,000)
4. **تجنب السطور الفارغة**: احذف السطور الفارغة قبل الاستيراد
5. **تحقق من الأكواد**: تأكد أن Project Code موجود في النظام
6. **نسخ احتياطي**: احتفظ بنسخة احتياطية قبل استيراد بيانات كبيرة

---

## 🛡️ الصلاحيات (Permissions)

### **للتصدير (Export):**
- Projects: `projects.export`
- BOQ: `boq.export`
- KPI: `kpi.export`

### **للاستيراد (Import):**
- Projects: `projects.create`
- BOQ: `boq.create`
- KPI: `kpi.create`

**الأدوار المسموح لها:**
- ✅ **Admin**: كل شيء
- ✅ **Manager**: تصدير واستيراد
- ✅ **Engineer**: تصدير فقط (BOQ و KPI)
- ❌ **Viewer**: لا يمكنه التصدير أو الاستيراد

---

## 🐛 حل المشاكل (Troubleshooting)

### **مشكلة: لا يظهر زر التصدير**
**الحل:**
- تحقق من صلاحياتك (يجب أن يكون لديك export permission)
- تأكد أن هناك بيانات في الجدول
- حدّث الصفحة

### **مشكلة: رسالة "الملف فارغ أو تنسيقه غير صحيح"**
**الحل:**
- تأكد أن الملف Excel أو CSV
- تحقق أن هناك بيانات في السطر الأول (Headers)
- تأكد أن الملف غير تالف

### **مشكلة: "عمود مطلوب غير موجود"**
**الحل:**
- استخدم القالب المقدم من النظام
- لا تغير أسماء الأعمدة
- تأكد من الأعمدة المطلوبة موجودة

### **مشكلة: "فشل الاستيراد: Duplicate key"**
**الحل:**
- تحقق من عدم تكرار Project Code
- احذف السجلات المكررة من الملف
- استخدم أكواد فريدة

### **مشكلة: الأحرف العربية تظهر رموز غريبة**
**الحل:**
- استخدم Excel بدلاً من CSV
- عند فتح CSV، اختر UTF-8 encoding
- استخدم Google Sheets للفتح التلقائي

---

## 📊 أمثلة عملية

### **مثال 1: تصدير مشاريع معينة**
```
الهدف: تصدير مشاريع القسم المدني فقط

الخطوات:
1. اذهب إلى Projects Management
2. استخدم الفلتر:
   - Responsible Division = "Enabling Division"
3. اضغط "تصدير"
4. اختر "Excel"
5. النتيجة: ملف يحتوي على مشاريع القسم المدني فقط
```

### **مثال 2: استيراد أنشطة BOQ جديدة**
```
الهدف: إضافة 20 نشاط BOQ جديد

الخطوات:
1. اذهب إلى BOQ Management
2. اضغط "قالب" لتحميل القالب
3. افتح الملف في Excel
4. املأ البيانات:
   - Project Code: P5090
   - Activity Name: Excavation
   - Unit: Cu.M
   - Planned Units: 1000
   - ... (20 سطر)
5. احفظ الملف
6. اضغط "استيراد"
7. اختر الملف
8. تحقق من المعاينة
9. اضغط "استيراد 20 سجل"
10. النتيجة: ✅ تم إضافة 20 نشاط جديد
```

### **مثال 3: تصدير KPIs لتحليل الأداء**
```
الهدف: تحليل أداء مشروع P5090

الخطوات:
1. اذهب إلى KPI Tracking
2. حدد Project = P5090 من الفلتر
3. انتظر تحميل البيانات
4. اضغط "تصدير"
5. اختر "Excel"
6. افتح الملف في Excel
7. استخدم Pivot Tables للتحليل
8. أنشئ رسوم بيانية
```

---

## 🎯 الخلاصة

تم إضافة نظام **Export/Import** متكامل يدعم:
- ✅ 3 صفحات رئيسية (Projects, BOQ, KPI)
- ✅ 3 صيغ (CSV, Excel, JSON)
- ✅ معاينة قبل الاستيراد
- ✅ قوالب جاهزة
- ✅ التحقق التلقائي
- ✅ دعم كامل للعربية
- ✅ صلاحيات محكمة
- ✅ معالجة أخطاء واضحة

**جاهز للاستخدام الفوري!** 🚀

---

## 📞 الدعم

إذا واجهت أي مشكلة:
1. راجع قسم "حل المشاكل" أعلاه
2. تحقق من صلاحياتك
3. تحقق من Console (F12) للأخطاء
4. اتصل بالدعم الفني

---

**الإصدار:** 1.0.0  
**تاريخ الإصدار:** 15 أكتوبر 2025  
**الحالة:** ✅ جاهز للإنتاج

