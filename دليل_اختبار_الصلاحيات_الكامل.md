# ๐งช ุฏููู ุงุฎุชุจุงุฑ ุงูุตูุงุญูุงุช ุงููุงูู
## Complete Permissions Testing Guide

---

## ๐ฏ **ุงููุฏู ูู ุงูุงุฎุชุจุงุฑ**

ุงูุชุฃูุฏ ูู ุฃู ูุธุงู ุงูุตูุงุญูุงุช ูุนูู ุจุดูู ุตุญูุญ ููููุน ุงููุณุชุฎุฏููู ูู:
1. โ ุงูุฏุฎูู ุฅูู ุงูุตูุญุงุช ุบูุฑ ุงููุตุฑุญ ุจูุง
2. โ ุฑุคูุฉ ุงูุฃุฒุฑุงุฑ ุงูุชู ูุง ูููููู ุตูุงุญูุฉ ุงุณุชุฎุฏุงููุง
3. โ ุชูููุฐ ุนูููุงุช ููุณ ูุฏููู ุตูุงุญูุฉ ููุง

---

## ๐ **ุฎุทูุงุช ุงูุงุฎุชุจุงุฑ ุงูุฃุณุงุณูุฉ**

### **1๏ธโฃ ุงูุฅุนุฏุงุฏ ุงูุฃููู**

#### **ุฃ. ุงูุชุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูู Supabase:**
1. ุงุฐูุจ ุฅูู Supabase Dashboard
2. ุงูุชุญ SQL Editor
3. ููุฐ ูุฐุง ุงูุงุณุชุนูุงู ูุฑุคูุฉ ุงูุตูุงุญูุงุช ุงูุญุงููุฉ:

```sql
SELECT 
  email,
  role,
  custom_permissions_enabled,
  array_length(permissions, 1) as permissions_count,
  permissions
FROM users
ORDER BY email;
```

#### **ุจ. ุงุฎุชุฑ ูุณุชุฎุฏู ููุงุฎุชุจุงุฑ:**
- ุงุฎุชุฑ ูุณุชุฎุฏู ููุณ Admin
- ุณุฌู ุงูุจุฑูุฏ ุงูุฅููุชุฑููู ูููุณุชุฎุฏู
- ุงุญูุธ ูููุฉ ุงููุฑูุฑ

---

### **2๏ธโฃ ุงุฎุชุจุงุฑ ููุน ุงูุฏุฎูู ููุตูุญุงุช**

#### **ุงุฎุชุจุงุฑ A: ููุน ุงูุฏุฎูู ูุตูุญุฉ Projects**

**ุงูุฎุทูุฉ 1: ุฅุฒุงูุฉ ุตูุงุญูุฉ projects.view**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'projects.view'),
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, permissions;
```

**ุงูุฎุทูุฉ 2: ุชุณุฌูู ุงูุฏุฎูู ุจุงููุณุชุฎุฏู**
1. ุงูุชุญ ูุงูุฐุฉ ูุชุตูุญ ุฌุฏูุฏุฉ (Incognito/Private)
2. ุงุฐูุจ ุฅูู ูููุนู
3. ุณุฌู ุฏุฎูู ุจุงููุณุชุฎุฏู ุงููุญุฏุฏ

**ุงูุฎุทูุฉ 3: ูุญุงููุฉ ุงูุฏุฎูู ูุตูุญุฉ Projects**
1. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉุ ุฌุฑุจ ุงูุถุบุท ุนูู "Projects"
2. ุฃู ุงูุชุจ ูู ุงููุชุตูุญ: `your-site.com/projects`

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุงููุณุชุฎุฏู ูุง ูุณุชุทูุน ุงูุฏุฎูู
- โ ุชุธูุฑ ุดุงุดุฉ "Access Denied" ุจุงูููู ุงูุฃุญูุฑ
- โ ุชุธูุฑ ุฑุณุงูุฉ: "You need permission to view projects"
- โ ูุธูุฑ ุฒุฑ "Go Back"
- โ ูู Console ุชุธูุฑ: `๐ Permission Guard: Result: โ Denied`

**ุฅุฐุง ูู ุชุธูุฑ ุดุงุดุฉ Access Denied:**
- โ ุงููุธุงู ูุง ูุนูู! ุชุงุจุน ุงูุฅุตูุงุญ ุฃุฏูุงู

---

#### **ุงุฎุชุจุงุฑ B: ููุน ุงูุฏุฎูู ูุตูุญุฉ BOQ**

**ุงูุฎุทูุฉ 1: ุฅุฒุงูุฉ ุตูุงุญูุฉ boq.view**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'boq.view'),
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, permissions;
```

**ุงูุฎุทูุฉ 2: ูุญุงููุฉ ุงูุฏุฎูู ูุตูุญุฉ BOQ**
1. ุญุฏูุซ ุงูุตูุญุฉ (F5)
2. ุฌุฑุจ ุงูุฏุฎูู ูุตูุญุฉ BOQ

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุงููุณุชุฎุฏู ูุง ูุณุชุทูุน ุงูุฏุฎูู
- โ ุชุธูุฑ ุดุงุดุฉ "Access Denied"

---

#### **ุงุฎุชุจุงุฑ C: ููุน ุงูุฏุฎูู ูุตูุญุฉ KPI**

**ุงูุฎุทูุฉ 1: ุฅุฒุงูุฉ ุตูุงุญูุฉ kpi.view**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'kpi.view'),
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, permissions;
```

**ุงูุฎุทูุฉ 2: ูุญุงููุฉ ุงูุฏุฎูู ูุตูุญุฉ KPI**

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุงููุณุชุฎุฏู ูุง ูุณุชุทูุน ุงูุฏุฎูู
- โ ุชุธูุฑ ุดุงุดุฉ "Access Denied"

---

#### **ุงุฎุชุจุงุฑ D: ููุน ุงูุฏุฎูู ูุตูุญุฉ Reports**

**ุงูุฎุทูุฉ 1: ุฅุฒุงูุฉ ุตูุงุญูุฉ reports.view**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'reports.view'),
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, permissions;
```

**ุงูุฎุทูุฉ 2: ูุญุงููุฉ ุงูุฏุฎูู ูุตูุญุฉ Reports**

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุงููุณุชุฎุฏู ูุง ูุณุชุทูุน ุงูุฏุฎูู
- โ ุชุธูุฑ ุดุงุดุฉ "Access Denied"

---

### **3๏ธโฃ ุงุฎุชุจุงุฑ ุฅุฎูุงุก ุงูุฃุฒุฑุงุฑ**

#### **ุงุฎุชุจุงุฑ E: ุฅุฎูุงุก ุฒุฑ "Add New Project"**

**ุงูุฎุทูุฉ 1: ุฅุฒุงูุฉ ุตูุงุญูุฉ projects.create ููุท (ูุน ุงูุงุญุชูุงุธ ุจู projects.view)**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'projects.create'),
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, permissions;
```

**ุงูุฎุทูุฉ 2: ุงูุฏุฎูู ูุตูุญุฉ Projects**
1. ุญุฏูุซ ุงูุตูุญุฉ (F5) ุฃู ุณุฌู ุฏุฎูู ูู ุฌุฏูุฏ
2. ุงุฐูุจ ุฅูู ุตูุญุฉ Projects

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุงููุณุชุฎุฏู ูุณุชุทูุน ุงูุฏุฎูู ูุตูุญุฉ Projects (ูุฃู ุนูุฏู projects.view)
- โ ุฒุฑ "Add New Project" ูุฎูู ุชูุงูุงู
- โ ุจุงูู ุงููุดุงุฑูุน ุธุงูุฑุฉ ููุนุฑุถ ููุท
- โ ูู Console: `๐ Permission Guard: Checking access for: projects.create` ุซู `โ Denied`

---

#### **ุงุฎุชุจุงุฑ F: ุฅุฎูุงุก ุฃุฒุฑุงุฑ Edit ูู Projects**

**ุงูุฎุทูุฉ 1: ุฅุฒุงูุฉ ุตูุงุญูุฉ projects.edit**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'projects.edit'),
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, permissions;
```

**ุงูุฎุทูุฉ 2: ุงูุชุญ ุตูุญุฉ Projects**

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุงููุณุชุฎุฏู ูุฑู ุงููุดุงุฑูุน
- โ ุฌููุน ุฃุฒุฑุงุฑ "Edit" ูุฎููุฉ ูู ูุฑูุช ุงููุดุงุฑูุน
- โ ุฃุฒุฑุงุฑ "View Details" ุธุงูุฑุฉ (ุฅุฐุง ูุงูุช ููุฌูุฏุฉ)

---

#### **ุงุฎุชุจุงุฑ G: ุฅุฎูุงุก ุฃุฒุฑุงุฑ Delete ูู Projects**

**ุงูุฎุทูุฉ 1: ุฅุฒุงูุฉ ุตูุงุญูุฉ projects.delete**
```sql
UPDATE users
SET 
  permissions = array_remove(permissions, 'projects.delete'),
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, permissions;
```

**ุงูุฎุทูุฉ 2: ุงูุชุญ ุตูุญุฉ Projects**

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุงููุณุชุฎุฏู ูุฑู ุงููุดุงุฑูุน
- โ ุฌููุน ุฃุฒุฑุงุฑ "Delete" ูุฎููุฉ ูู ูุฑูุช ุงููุดุงุฑูุน

---

### **4๏ธโฃ ุงุฎุชุจุงุฑ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ (Sidebar)**

#### **ุงุฎุชุจุงุฑ H: ุฅุฎูุงุก ุนูุงุตุฑ ุงููุงุฆูุฉ**

**ุงูุฎุทูุฉ 1: ุฅุฒุงูุฉ ุฌููุน ุตูุงุญูุงุช Projects**
```sql
UPDATE users
SET 
  permissions = ARRAY(
    SELECT unnest(permissions) 
    EXCEPT 
    SELECT unnest(ARRAY['projects.view', 'projects.create', 'projects.edit', 'projects.delete', 'projects.export'])
  ),
  custom_permissions_enabled = true,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, permissions;
```

**ุงูุฎุทูุฉ 2: ุญุฏูุซ ุงูุตูุญุฉ**

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุนูุตุฑ "Projects" ูุฎุชูู ุชูุงูุงู ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ
- โ ุงูุนูุงุตุฑ ุงูุฃุฎุฑู (BOQ, KPI, ุฅูุฎ) ูุง ุฒุงูุช ุธุงูุฑุฉ

---

### **5๏ธโฃ ุงุฎุชุจุงุฑ ุงูุงุณุชุนุงุฏุฉ**

#### **ุงุฎุชุจุงุฑ I: ุงุณุชุนุงุฏุฉ ุงูุตูุงุญูุงุช**

**ุงูุฎุทูุฉ 1: ุงุณุชุนุงุฏุฉ ุฌููุน ุงูุตูุงุญูุงุช ุญุณุจ ุงูุฏูุฑ**
```sql
UPDATE users
SET 
  permissions = CASE role
    WHEN 'viewer' THEN ARRAY[
      'projects.view',
      'boq.view',
      'kpi.view',
      'reports.view', 'reports.daily', 'reports.weekly', 'reports.monthly',
      'settings.view',
      'database.view',
      'dashboard.view'
    ]
    WHEN 'engineer' THEN ARRAY[
      'projects.view', 'projects.create', 'projects.edit',
      'boq.view', 'boq.create', 'boq.edit',
      'kpi.view', 'kpi.create', 'kpi.edit',
      'reports.view', 'reports.daily', 'reports.weekly',
      'settings.view',
      'dashboard.view'
    ]
    WHEN 'manager' THEN ARRAY[
      'projects.view', 'projects.create', 'projects.edit', 'projects.delete', 'projects.export',
      'boq.view', 'boq.create', 'boq.edit', 'boq.approve', 'boq.export',
      'kpi.view', 'kpi.create', 'kpi.edit', 'kpi.export',
      'reports.view', 'reports.create', 'reports.export', 'reports.daily', 'reports.weekly', 'reports.monthly',
      'users.view',
      'settings.view', 'settings.holidays.view', 'settings.holidays.create', 'settings.holidays.edit', 'settings.holidays.delete',
      'dashboard.view'
    ]
    ELSE permissions -- Keep admin as is
  END,
  custom_permissions_enabled = false,
  updated_at = NOW()
WHERE email = 'USER_EMAIL_HERE'
RETURNING email, role, array_length(permissions, 1) as permissions_count;
```

**ุงูุฎุทูุฉ 2: ุญุฏูุซ ุงูุตูุญุฉ**

**ุงููุชูุฌุฉ ุงููุชููุนุฉ:** โ
- โ ุฌููุน ุงูุตูุญุงุช ุชุนูุฏ ููุธููุฑ
- โ ุฌููุน ุงูุฃุฒุฑุงุฑ ุชุนูุฏ ููุธููุฑ
- โ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ุชุนุฑุถ ุฌููุน ุงูุนูุงุตุฑ

---

## ๐ **ูุญุต Console ููุชุฃูุฏ**

### **ูุง ูุฌุจ ุฃู ุชุฑุงู ูู Console:**

#### **ุนูุฏ ููุน ุตูุงุญูุฉ:**
```
๐ Permission Guard: Checking access for: projects.view
๐ Permission Guard: Result: โ Denied
```

#### **ุนูุฏ ููุญ ุตูุงุญูุฉ:**
```
๐ Permission Guard: Checking access for: projects.view
๐ Permission Guard: Result: โ Granted
```

#### **ุนูุฏ ูุญุต ุตูุงุญูุงุช ุงููุณุชุฎุฏู:**
```
๐ Permission Guard: Current permissions: ['projects.view', 'boq.view', ...]
```

---

## โ **ุฅุฐุง ูู ูุนูู ุงููุธุงู**

### **ุงูุณููุงุฑูู 1: ุงูุตูุญุฉ ุชูุชุญ ุฑุบู ุฅุฒุงูุฉ ุงูุตูุงุญูุฉ**

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุญุฏูุซ ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุณุฌู ุฎุฑูุฌ ุซู ุฏุฎูู ูู ุฌุฏูุฏ
3. ุงูุชุญ Console ูุงุจุญุซ ุนู ุฑุณุงุฆู ุงูุตูุงุญูุงุช
4. ุชุฃูุฏ ูู ุฃู `appUser.permissions` ูุญุฏูุซ

```sql
-- ุชุญูู ูู ุงูุจูุงูุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
SELECT email, permissions, updated_at
FROM users
WHERE email = 'USER_EMAIL_HERE';
```

### **ุงูุณููุงุฑูู 2: ุงูุฃุฒุฑุงุฑ ูุง ุฒุงูุช ุธุงูุฑุฉ**

**ุงูุญู:**
1. ุญุฏูุซ ุงูุตูุญุฉ (F5) ุฃู Ctrl+Shift+R
2. ุชุฃูุฏ ูู ุฃู ุงููููู ูุณุชุฎุฏู `guard.hasAccess()`
3. ุงูุชุญ Console ูุงุจุญุซ ุนู ุฑุณุงุฆู ุงูุตูุงุญูุงุช

### **ุงูุณููุงุฑูู 3: ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ูุง ุชุชุบูุฑ**

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุฃู `ModernSidebar` ูุณุชุฎุฏู `usePermissionGuard()`
2. ุณุฌู ุฎุฑูุฌ ูุฏุฎูู ูู ุฌุฏูุฏ
3. ุงูุณุญ ุงููุงุด: Ctrl+Shift+Delete

---

## โ **ูุงุฆูุฉ ูุญุต ููุงุฆูุฉ**

### **ุงุฎุชุจุงุฑุงุช ูุฌุจ ุฃู ุชูุฌุญ:**

- [ ] **Test A:** ููุน ุงูุฏุฎูู ูู Projects ุนูุฏ ุฅุฒุงูุฉ `projects.view` โ
- [ ] **Test B:** ููุน ุงูุฏุฎูู ูู BOQ ุนูุฏ ุฅุฒุงูุฉ `boq.view` โ
- [ ] **Test C:** ููุน ุงูุฏุฎูู ูู KPI ุนูุฏ ุฅุฒุงูุฉ `kpi.view` โ
- [ ] **Test D:** ููุน ุงูุฏุฎูู ูู Reports ุนูุฏ ุฅุฒุงูุฉ `reports.view` โ
- [ ] **Test E:** ุฅุฎูุงุก ุฒุฑ "Add New Project" ุนูุฏ ุฅุฒุงูุฉ `projects.create` โ
- [ ] **Test F:** ุฅุฎูุงุก ุฃุฒุฑุงุฑ "Edit" ุนูุฏ ุฅุฒุงูุฉ `projects.edit` โ
- [ ] **Test G:** ุฅุฎูุงุก ุฃุฒุฑุงุฑ "Delete" ุนูุฏ ุฅุฒุงูุฉ `projects.delete` โ
- [ ] **Test H:** ุฅุฎูุงุก ุนูุตุฑ ุงููุงุฆูุฉ ุนูุฏ ุฅุฒุงูุฉ ุฌููุน ุตูุงุญูุงุช ุงููุณู โ
- [ ] **Test I:** ุงุณุชุนุงุฏุฉ ุงูุตูุงุญูุงุช ุชุนูุฏ ูู ุดูุก ููุนูู โ

---

## ๐ฏ **ุงููุชูุฌุฉ ุงูููุงุฆูุฉ**

ุฅุฐุง ูุฌุญุช ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุฃุนูุงู:

```
โ ูุธุงู ุงูุตูุงุญูุงุช ูุนูู ุจุดูู ุตุญูุญ 100%
โ ุงูุตูุญุงุช ูุญููุฉ
โ ุงูุฃุฒุฑุงุฑ ูุญููุฉ
โ ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ ูุญููุฉ
โ ุฌุงูุฒ ููุฅูุชุงุฌ
```

---

## ๐ **ููุงุญุธุงุช ูููุฉ**

1. **ุฏุงุฆูุงู ุงุณุชุฎุฏู ูุงูุฐุฉ Incognito ููุงุฎุชุจุงุฑ** - ูุชุฌูุจ ูุดุงูู ุงููุงุด
2. **ุณุฌู ุฎุฑูุฌ ูุฏุฎูู ุจุนุฏ ูู ุชุบููุฑ ูู ุงูุตูุงุญูุงุช** - ูุชุญุฏูุซ ุงูู session
3. **ุงูุชุญ Console ุฏุงุฆูุงู** - ูุฑุคูุฉ ุฑุณุงุฆู ุงูุตูุงุญูุงุช
4. **ุงุญูุธ ูุณุฎุฉ ูู ุงูุตูุงุญูุงุช ุงูุฃุตููุฉ** - ูุจู ุงูุจุฏุก ูู ุงูุงุฎุชุจุงุฑ

---

## ๐ **ุงูุจุฏุก ูู ุงูุงุฎุชุจุงุฑ**

**ุงูุฎุทูุฉ ุงูุชุงููุฉ:**
1. ุงูุชุญ Supabase SQL Editor
2. ููุฐ ุงูุงุณุชุนูุงู ุงูุฃูู ูุฑุคูุฉ ุงูุตูุงุญูุงุช
3. ุงุฎุชุฑ ูุณุชุฎุฏู ููุงุฎุชุจุงุฑ
4. ุงุจุฏุฃ ูู **Test A**

**ุญุธุงู ููููุงู! ๐**
