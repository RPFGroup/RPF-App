# 📊 دليل رفع البيانات إلى Supabase

هذا الدليل يوضح كيفية رفع البيانات من ملفات CSV إلى قاعدة بيانات Supabase لتحسين تجربة الاستخدام.

## 📁 الملفات المطلوبة

تأكد من وجود الملفات التالية في مجلد `Database/`:
- `Planning Database - ProjectsList.csv` - بيانات المشاريع
- `Planning Database - BOQ Rates .csv` - بيانات أنشطة BOQ
- `Planning Database - KPI.csv` - بيانات مؤشرات الأداء

## 🔧 الإعداد المطلوب

### 1. متغيرات البيئة
تأكد من وجود الملف `.env.local` في المجلد الرئيسي للمشروع مع المتغيرات التالية:

```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_project_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
SUPABASE_SERVICE_ROLE_KEY=your_supabase_service_role_key
```

### 2. تثبيت التبعيات
```bash
cd scripts
npm install
```

## 🚀 تشغيل رفع البيانات

### رفع جميع البيانات (مستحسن)
```bash
npm run import
```

### رفع البيانات بشكل منفصل
```bash
# رفع المشاريع فقط
npm run import:projects

# رفع أنشطة BOQ فقط
npm run import:boq

# رفع KPIs فقط
npm run import:kpi
```

## 📋 ما يحدث أثناء الرفع

### 1. رفع المشاريع
- يقرأ ملف `ProjectsList.csv`
- ينظف البيانات ويحولها للتنسيق المطلوب
- يرفع المشاريع إلى جدول `projects`

### 2. رفع أنشطة BOQ
- يقرأ ملف `BOQ Rates .csv`
- يربط الأنشطة بالمشاريع المناسبة
- ينظف البيانات الرقمية والتواريخ
- يرفع الأنشطة إلى جدول `boq_activities`

### 3. رفع KPIs
- يقرأ ملف `KPI.csv`
- يربط KPIs بالمشاريع والأنشطة
- ينشئ مؤشرات أداء من البيانات
- يرفع KPIs إلى جدول `kpi_records`

## 🧹 تنظيف البيانات

السكريبت ينظف البيانات تلقائياً:

### الأرقام
- يزيل رموز العملة (AED, $)
- يزيل الفواصل من الأرقام
- يحول النسب المئوية

### التواريخ
- يحول التواريخ لتنسيق ISO
- يتعامل مع التواريخ الفارغة أو غير الصحيحة
- يحول `Dec 30, 1899` إلى `null`

### النصوص
- يزيل علامات الاقتباس
- ينظف المسافات الزائدة
- يتعامل مع القيم الفارغة

## ⚠️ ملاحظات مهمة

### 1. مسح البيانات الموجودة
السكريبت **يمسح جميع البيانات الموجودة** قبل الرفع. إذا كنت تريد الاحتفاظ بالبيانات الموجودة، قم بتعديل السكريبت.

### 2. حجم البيانات
البيانات كبيرة (أكثر من 1500 نشاط و 18000 KPI)، لذلك قد يستغرق الرفع عدة دقائق.

### 3. الأخطاء المحتملة
- تأكد من صحة متغيرات البيئة
- تأكد من وجود ملفات CSV
- تأكد من تشغيل schema قاعدة البيانات أولاً

## 🔍 التحقق من النتائج

بعد الرفع، يمكنك التحقق من البيانات في:

### Supabase Dashboard
1. اذهب إلى Supabase Dashboard
2. اختر مشروعك
3. اذهب إلى Table Editor
4. تحقق من الجداول: `projects`, `boq_activities`, `kpi_records`

### التطبيق
1. شغل التطبيق: `npm run dev`
2. سجل دخولك
3. تحقق من لوحة التحكم والمشاريع

## 📊 إحصائيات متوقعة

بعد الرفع الناجح، يجب أن تجد:
- **~300 مشروع** في جدول `projects`
- **~1500 نشاط** في جدول `boq_activities`
- **~18000 KPI** في جدول `kpi_records`

## 🆘 حل المشاكل

### خطأ في متغيرات البيئة
```
❌ Missing Supabase environment variables
```
**الحل**: تأكد من وجود `.env.local` مع المتغيرات الصحيحة

### خطأ في ملفات CSV
```
❌ Error reading CSV file
```
**الحل**: تأكد من وجود الملفات في مجلد `Database/`

### خطأ في قاعدة البيانات
```
❌ Error inserting data
```
**الحل**: تأكد من تشغيل schema قاعدة البيانات أولاً

## 🎯 النتيجة النهائية

بعد الرفع الناجح، ستحصل على:
- ✅ بيانات حقيقية في التطبيق
- ✅ تجربة مستخدم محسنة
- ✅ إحصائيات واقعية في لوحة التحكم
- ✅ مشاريع وأنشطة وKPIs جاهزة للاستخدام

---

**ملاحظة**: هذا السكريبت مصمم خصيصاً لبيانات Rabat MVP وقد يحتاج تعديل للبيانات الأخرى.
