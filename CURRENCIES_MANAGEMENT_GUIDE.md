# ๐ฐ ุฏููู ุฅุฏุงุฑุฉ ุงูุนููุงุช (Currencies Management)

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุดุงูู ูุฅุฏุงุฑุฉ ุงูุนููุงุช ูุน ุชุญุฏูุฏ ุชููุงุฆู ููุนููุฉ ุงูุฅูุงุฑุงุชูุฉ (AED) ูุงูุชุฑุงุถูุ ูุน ุฅููุงููุฉ ุชุบููุฑ ุงูุนููุฉ ุญุณุจ ูููุน ุงููุดุฑูุน.

## โจ ุงููุฒุงูุง ุงูุฌุฏูุฏุฉ

### 1. **ุงูุนููุงุช ุงูุงูุชุฑุงุถูุฉ (3 ุนููุงุช)**
- **AED (UAE Dirham)** - ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ ๐
- **USD (US Dollar)** - ููุฏููุงุฑ ุงูุฃูุฑููู
- **SAR (Saudi Riyal)** - ููุฑูุงู ุงูุณุนูุฏู

### 2. **ุงูุชุญุฏูุฏ ุงูุชููุงุฆู ููุนููุฉ**
- โ **ุงูุฅูุงุฑุงุช**: AED (ุงูุชุฑุงุถู)
- โ **ุงูุณุนูุฏูุฉ**: SAR
- โ **ุฃูุฑููุง**: USD
- โ **ุฃู ููุงู ุขุฎุฑ**: AED (ุงูุชุฑุงุถู)

### 3. **ุฅุฏุงุฑุฉ ูุงููุฉ ููุนููุงุช**
- โ ุฅุถุงูุฉ ุนููุงุช ุฌุฏูุฏุฉ
- โ ุชุนุฏูู ุงูุนููุงุช ุงูููุฌูุฏุฉ
- โ ุญุฐู (ุชุนุทูู) ุงูุนููุงุช
- โ ุชุญุฏูุฏ ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ
- โ ุชุชุจุน ุนุฏุฏ ุงูุงุณุชุฎุฏุงูุงุช
- โ ุชุญููู ุงูุนููุงุช

## ๐๏ธ ุงูุจููุฉ ุงูุชูููุฉ

### ุงููููุงุช ุงูุฌุฏูุฏุฉ

1. **`lib/currenciesManager.ts`**
   - ุฅุฏุงุฑุฉ ุงูุนูููุงุช ูุน Supabase
   - ุชุญุฏูุฏ ุงูุนููุฉ ุชููุงุฆูุงู ุญุณุจ ุงููููุน
   - ุชุญููู ุงูุนููุงุช
   - ุชูุณูู ุงููุจุงูุบ

2. **`components/settings/CurrenciesManager.tsx`**
   - ูุงุฌูุฉ ูุณุชุฎุฏู ูุฅุฏุงุฑุฉ ุงูุนููุงุช
   - ูููุฐุฌ ุฅุถุงูุฉ/ุชุนุฏูู ุงูุนููุงุช
   - ุนุฑุถ ุงูุนููุงุช ูุน ุงูุฑููุฒ ูุงูุฃุณุนุงุฑ

3. **`Database/currencies-table-schema.sql`**
   - SQL Schema ูุฌุฏูู ุงูุนููุงุช
   - ุฏุงูุฉ ุชุญุฏูุฏ ุงูุนููุฉ ุชููุงุฆูุงู
   - Row Level Security (RLS)

### ุงูุชุญุฏูุซุงุช ุนูู ุงููููุงุช ุงูููุฌูุฏุฉ

1. **`components/settings/SettingsPage.tsx`**
   - ุฅุถุงูุฉ ุชุงุจ "Currencies" ูููุณุคูููู ูุงููุฏุฑุงุก
   - ุนุฑุถ ูููู CurrenciesManager

## ๐ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `currencies`

```sql
CREATE TABLE currencies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
  code VARCHAR(3) NOT NULL UNIQUE, -- ูุซู: AED, USD, SAR
  name VARCHAR(100) NOT NULL, -- ูุซู: UAE Dirham, US Dollar
  symbol VARCHAR(10) NOT NULL, -- ูุซู: ุฏ.ุฅ, $, ุฑ.ุณ
  exchange_rate DECIMAL(10, 6) NOT NULL DEFAULT 1.0, -- ุณุนุฑ ุงูุตุฑู ููุงุจู AED
  is_default BOOLEAN DEFAULT FALSE, -- ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ
  is_active BOOLEAN DEFAULT TRUE,
  usage_count INTEGER DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
  updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
```

### ุงูุฃุนูุฏุฉ

- **id**: ุงููุนุฑู ุงููุฑูุฏ (UUID)
- **code**: ุฑูุฒ ุงูุนููุฉ (3 ุฃุญุฑูุ ISO 4217)
- **name**: ุงุณู ุงูุนููุฉ
- **symbol**: ุฑูุฒ ุงูุนููุฉ ููุนุฑุถ
- **exchange_rate**: ุณุนุฑ ุงูุตุฑู ููุงุจู ุงูุฏุฑูู ุงูุฅูุงุฑุงุชู
- **is_default**: ูู ูุฐู ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉุ
- **is_active**: ูู ุงูุนููุฉ ูุดุทุฉุ
- **usage_count**: ุนุฏุฏ ุงููุดุงุฑูุน ุงูุชู ุชุณุชุฎุฏู ูุฐู ุงูุนููุฉ
- **created_at**: ุชุงุฑูุฎ ุงูุฅูุดุงุก
- **updated_at**: ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ

## ๐ ุงูุชุซุจูุช ูุงูุฅุนุฏุงุฏ

### 1. ุฅูุดุงุก ุฌุฏูู ุงูุนููุงุช ูู Supabase

ูู ุจุชุดุบูู SQL Script ูู Supabase SQL Editor:

```bash
# ุงูุชุญ Supabase Dashboard
# ุงูุชูู ุฅูู SQL Editor
# ููุฐ ูุญุชูู ููู: Database/currencies-table-schema.sql
```

### 2. ุงูุชุญูู ูู Row Level Security (RLS)

ุงูุตูุงุญูุงุช ุงููุถุจูุทุฉ:
- **ุงููุฑุงุกุฉ**: ุฌููุน ุงููุณุชุฎุฏููู (ุงูุนููุงุช ุงููุดุทุฉ ููุท)
- **ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู/ุงูุญุฐู**: ุงููุณุชุฎุฏููู ุงููุตุฑุญ ููู ููุท

## ๐ป ุงูุงุณุชุฎุฏุงู

### ูููุทูุฑูู

#### ุฌูุจ ุฌููุน ุงูุนููุงุช

```typescript
import { getAllCurrencies, getDefaultCurrency } from '@/lib/currenciesManager'

// ุฌูุจ ุฌููุน ุงูุนููุงุช
const currencies = await getAllCurrencies()

// ุฌูุจ ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ
const defaultCurrency = await getDefaultCurrency()
```

#### ุชุญุฏูุฏ ุงูุนููุฉ ุชููุงุฆูุงู

```typescript
import { getCurrencyForProject } from '@/lib/currenciesManager'

// ุชุญุฏูุฏ ุงูุนููุฉ ุญุณุจ ูููุน ุงููุดุฑูุน
const currency = await getCurrencyForProject('UAE') // ุณูุนูุฏ AED
const currency2 = await getCurrencyForProject('Saudi Arabia') // ุณูุนูุฏ SAR
const currency3 = await getCurrencyForProject('USA') // ุณูุนูุฏ USD
const currency4 = await getCurrencyForProject() // ุณูุนูุฏ AED (ุงูุชุฑุงุถู)
```

#### ุชุญููู ุงูุนููุงุช

```typescript
import { convertCurrency, formatCurrency } from '@/lib/currenciesManager'

// ุชุญููู ูู USD ุฅูู AED
const convertedAmount = convertCurrency(100, usdCurrency, aedCurrency)

// ุชูุณูู ุงููุจูุบ ูุน ุฑูุฒ ุงูุนููุฉ
const formatted = formatCurrency(1000, aedCurrency) // "1,000.00 ุฏ.ุฅ"
```

#### ุฅุถุงูุฉ ุนููุฉ ุฌุฏูุฏุฉ

```typescript
import { addCurrency } from '@/lib/currenciesManager'

const result = await addCurrency({
  code: 'EUR',
  name: 'Euro',
  symbol: 'โฌ',
  exchange_rate: 0.25, // 1 AED = 0.25 EUR
  is_default: false,
  is_active: true
})
```

### ูููุณุชุฎุฏููู

#### ุงููุตูู ุฅูู ุฅุฏุงุฑุฉ ุงูุนููุงุช

1. ุงูุชูู ุฅูู **Settings** โ๏ธ
2. ุงุฎุชุฑ ุชุงุจ **Currencies** ๐ฐ
3. ููููู:
   - ุนุฑุถ ุฌููุน ุงูุนููุงุช
   - ุฅุถุงูุฉ ุนููุฉ ุฌุฏูุฏุฉ
   - ุชุนุฏูู ุนููุฉ ููุฌูุฏุฉ
   - ุชุญุฏูุฏ ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ
   - ุญุฐู ุนููุฉ

#### ุฅุถุงูุฉ ุนููุฉ ุฌุฏูุฏุฉ

1. ุงุถุบุท ุนูู **Add Currency**
2. ุฃุฏุฎู:
   - **Currency Code**: 3 ุฃุญุฑู (ูุซู: EUR, GBP)
   - **Currency Name**: ุงุณู ุงูุนููุฉ
   - **Symbol**: ุฑูุฒ ุงูุนููุฉ (ูุซู: โฌ, ยฃ)
   - **Exchange Rate**: ุณุนุฑ ุงูุตุฑู ููุงุจู AED
   - **Set as default**: ุฅุฐุง ููุช ุชุฑูุฏ ุฌุนููุง ุงูุงูุชุฑุงุถูุฉ

## ๐ ุงูุฃูุงู

### Row Level Security (RLS)

```sql
-- ุณูุงุณุฉ ุงููุฑุงุกุฉ (ุงูุฌููุน)
CREATE POLICY "Anyone can view active currencies"
  ON currencies FOR SELECT
  USING (is_active = TRUE);

-- ุณูุงุณุฉ ุงูุฅุถุงูุฉ/ุงูุชุนุฏูู/ุงูุญุฐู (ุงููุตุฑุญ ููู ููุท)
CREATE POLICY "Authenticated users can manage currencies"
  ON currencies FOR ALL
  TO authenticated
  USING (TRUE);
```

### ุตูุงุญูุงุช ุงููุณุชุฎุฏููู

- **Admin & Manager**: ุงููุตูู ุงููุงูู ูุฅุฏุงุฑุฉ ุงูุนููุงุช
- **Engineer & Viewer**: ุงููุฑุงุกุฉ ููุท

## ๐ ุงูุฅุญุตุงุฆูุงุช

### ุฏุงูุฉ `get_currency_stats()`

```sql
SELECT * FROM get_currency_stats();
```

ุชุนุฑุถ:
- ุฑูุฒ ุงูุนููุฉ
- ุงุณู ุงูุนููุฉ
- ุฑูุฒ ุงูุนููุฉ
- ุนุฏุฏ ุงููุดุงุฑูุน
- ุฅุฌูุงูู ูููุฉ ุงูุนููุฏ

## ๐ฏ ุฃูุถู ุงูููุงุฑุณุงุช

1. **ุงุณุชุฎุฏู ุฑููุฒ ISO 4217**: 
   - ูุซู: AED, USD, SAR, EUR
   - ูุนูุงุฑ ุนุงููู ููุนููุงุช

2. **ุญุฏุฏ ุณุนุฑ ุงูุตุฑู ุจุฏูุฉ**:
   - ุงุณุชุฎุฏู 6 ููุงุฒู ุนุดุฑูู ููุฏูุฉ
   - ุญุฏุซ ุงูุฃุณุนุงุฑ ุจุงูุชุธุงู

3. **ูุง ุชุญุฐู ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ**:
   - ุงููุธุงู ูููุน ุญุฐู ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ
   - ูููู ุชุบููุฑ ุงูุนููุฉ ุงูุงูุชุฑุงุถูุฉ ููุท

4. **ุชุชุจุน ุงูุงุณุชุฎุฏุงู**:
   - ุฑุงูุจ usage_count ููุนุฑูุฉ ุงูุนููุงุช ุงูุฃูุซุฑ ุงุณุชุฎุฏุงูุงู
   - ูุณุงุนุฏ ูู ุงูุชุฎุทูุท ุงููุงูู

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงูุนููุฉ ูุง ุชุธูุฑ ูู ุงููุงุฆูุฉ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู `is_active = true`
- ูู ุจุชุญุฏูุซ ุงูุตูุญุฉ
- ุชุญูู ูู ุงูุงุชุตุงู ุจู Supabase

### ุฎุทุฃ ุนูุฏ ุฅุถุงูุฉ ุนููุฉ ุฌุฏูุฏุฉ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุนุฏู ูุฌูุฏ ุนููุฉ ุจููุณ ุงูููุฏ
- ุชุญูู ูู ุฃู ุงูููุฏ 3 ุฃุญุฑู ููุท
- ุชุญูู ูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู

### ุณุนุฑ ุงูุตุฑู ุบูุฑ ุตุญูุญ

**ุงูุญู:**
- ุชุฃูุฏ ูู ุฃู ุงูุณุนุฑ ููุงุจู AED
- ุงุณุชุฎุฏู 6 ููุงุฒู ุนุดุฑูู ููุฏูุฉ
- ุญุฏุซ ุงูุฃุณุนุงุฑ ุจุงูุชุธุงู

## ๐ ุงูุชุญุฏูุซุงุช ุงููุณุชูุจููุฉ

### ูุฎุทุท ุงูุชุทููุฑ
- [ ] ุชุญุฏูุซ ุชููุงุฆู ูุฃุณุนุงุฑ ุงูุตุฑู
- [ ] ุฑุจุท ูุน APIs ูุงููุฉ
- [ ] ุชูุงุฑูุฑ ูุงููุฉ ุชูุตูููุฉ
- [ ] ุชุญููู ุงูุนููุงุช ูู ุงูููุช ุงููุนูู
- [ ] ุชุงุฑูุฎ ุงูุชุบููุฑุงุช (Audit Log)

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงูู ุฃู ูุฏูู ุงูุชุฑุงุญุงุช:
1. ุชุญูู ูู console.log ููุฃุฎุทุงุก
2. ุฑุงุฌุน Supabase logs
3. ุชุฃูุฏ ูู ุชูููุฐ SQL Schema ุจุดูู ุตุญูุญ

---

## ๐ ุงูุฎูุงุตุฉ

ุชู ุฅุถุงูุฉ ูุธุงู ุฅุฏุงุฑุฉ ุงูุนููุงุช ูุน:

### โ ุงููุฒุงูุง:
- ุชุญุฏูุฏ ุชููุงุฆู ููุนููุฉ ุงูุฅูุงุฑุงุชูุฉ (AED)
- ุฏุนู ุงูุนููุงุช ุงููุชุนุฏุฏุฉ
- ุชุญููู ุงูุนููุงุช
- ุฅุฏุงุฑุฉ ูู ุงูุฅุนุฏุงุฏุงุช
- ุฃูุงู ูุชูุฏู ูุน RLS

### ๐ ุฌุงูุฒ ููุงุณุชุฎุฏุงู:
- 3 ุนููุงุช ุงูุชุฑุงุถูุฉ
- ุชุญุฏูุฏ ุชููุงุฆู ุญุณุจ ุงููููุน
- ุฅููุงููุฉ ุฅุถุงูุฉ ุนููุงุช ุฌุฏูุฏุฉ
- ุชุญููู ูุชูุณูู ุงููุจุงูุบ

**ุชู ุงูุชุทููุฑ ุจูุงุณุทุฉ:** AI Assistant  
**ุงูุชุงุฑูุฎ:** 2025-10-07  
**ุงูุฅุตุฏุงุฑ:** 1.0.0
